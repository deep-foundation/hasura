(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[12],{"9f0y":function(e,t,r){"use strict";r.r(t),r.d(t,"ARCanvas",(function(){return cr})),r.d(t,"DefaultXRControllers",(function(){return vr})),r.d(t,"Hands",(function(){return mr})),r.d(t,"InteractionManager",(function(){return tr})),r.d(t,"InteractionsContext",(function(){return er})),r.d(t,"Interactive",(function(){return nr})),r.d(t,"RayGrab",(function(){return ar})),r.d(t,"VRCanvas",(function(){return lr})),r.d(t,"XR",(function(){return sr})),r.d(t,"XRController",(function(){return Wt})),r.d(t,"useController",(function(){return hr})),r.d(t,"useHitTest",(function(){return or})),r.d(t,"useInteraction",(function(){return rr})),r.d(t,"useXR",(function(){return pr})),r.d(t,"useXREvent",(function(){return Jt}));var n={};r.r(n),r.d(n,"Deflate",(function(){return Be})),r.d(n,"AsyncDeflate",(function(){return He})),r.d(n,"deflate",(function(){return Ge})),r.d(n,"deflateSync",(function(){return Ve})),r.d(n,"Inflate",(function(){return ze})),r.d(n,"AsyncInflate",(function(){return Xe})),r.d(n,"inflate",(function(){return Ke})),r.d(n,"inflateSync",(function(){return We})),r.d(n,"Gzip",(function(){return qe})),r.d(n,"AsyncGzip",(function(){return Ye})),r.d(n,"gzip",(function(){return $e})),r.d(n,"gzipSync",(function(){return Ze})),r.d(n,"Gunzip",(function(){return Qe})),r.d(n,"AsyncGunzip",(function(){return Je})),r.d(n,"gunzip",(function(){return et})),r.d(n,"gunzipSync",(function(){return tt})),r.d(n,"Zlib",(function(){return rt})),r.d(n,"AsyncZlib",(function(){return nt})),r.d(n,"zlib",(function(){return at})),r.d(n,"zlibSync",(function(){return it})),r.d(n,"Unzlib",(function(){return ot})),r.d(n,"AsyncUnzlib",(function(){return st})),r.d(n,"unzlib",(function(){return ut})),r.d(n,"unzlibSync",(function(){return lt})),r.d(n,"compress",(function(){return $e})),r.d(n,"AsyncCompress",(function(){return Ye})),r.d(n,"compressSync",(function(){return Ze})),r.d(n,"Compress",(function(){return qe})),r.d(n,"Decompress",(function(){return ct})),r.d(n,"AsyncDecompress",(function(){return pt})),r.d(n,"decompress",(function(){return ht})),r.d(n,"decompressSync",(function(){return ft})),r.d(n,"DecodeUTF8",(function(){return xt})),r.d(n,"EncodeUTF8",(function(){return wt})),r.d(n,"strToU8",(function(){return bt})),r.d(n,"strFromU8",(function(){return Tt})),r.d(n,"ZipPassThrough",(function(){return Lt})),r.d(n,"ZipDeflate",(function(){return Ot})),r.d(n,"AsyncZipDeflate",(function(){return Ct})),r.d(n,"Zip",(function(){return Pt})),r.d(n,"zip",(function(){return Nt})),r.d(n,"zipSync",(function(){return _t})),r.d(n,"UnzipPassThrough",(function(){return kt})),r.d(n,"UnzipInflate",(function(){return Dt})),r.d(n,"AsyncUnzipInflate",(function(){return Ft})),r.d(n,"Unzip",(function(){return Ut})),r.d(n,"unzip",(function(){return jt})),r.d(n,"unzipSync",(function(){return Bt}));var a=r("wx14"),i=r("Womt"),o=function(){function e(e){i.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new s(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new u(e)})),this.register((function(e){return new a(e)})),this.register((function(e){return new p(e)}))}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(i.Loader.prototype),{constructor:e,load:function(e,t,r,n){var a,o=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:i.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);var s=function(t){n?n(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},u=new i.FileLoader(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,(function(r){try{o.parse(r,a,(function(r){t(r),o.manager.itemEnd(e)}),s)}catch(n){s(n)}}),r,s)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,a,s){var u,l={},c={};if("string"===typeof e)u=e;else if(i.LoaderUtils.decodeText(new Uint8Array(e,0,4))===h){try{l[r.KHR_BINARY_GLTF]=new v(e)}catch(M){return void(s&&s(M))}u=l[r.KHR_BINARY_GLTF].content}else u=i.LoaderUtils.decodeText(new Uint8Array(e));var p=JSON.parse(u);if(void 0===p.asset||p.asset.version[0]<2)s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var f=new X(p,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});f.fileLoader.setRequestHeader(this.requestHeader);for(var d=0;d<this.pluginCallbacks.length;d++){var y=this.pluginCallbacks[d](f);c[y.name]=y,l[y.name]=!0}if(p.extensionsUsed)for(d=0;d<p.extensionsUsed.length;++d){var b=p.extensionsUsed[d],T=p.extensionsRequired||[];switch(b){case r.KHR_MATERIALS_UNLIT:l[b]=new o;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:l[b]=new x;break;case r.KHR_DRACO_MESH_COMPRESSION:l[b]=new m(p,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:l[b]=new n(this.ddsLoader);break;case r.KHR_TEXTURE_TRANSFORM:l[b]=new g;break;case r.KHR_MESH_QUANTIZATION:l[b]=new w;break;default:T.indexOf(b)>=0&&void 0===c[b]&&console.warn('THREE.GLTFLoader: Unknown extension "'+b+'".')}}f.setExtensions(l),f.setPlugins(c),f.parse(a,s)}}});var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=e}function a(e){this.parser=e,this.name=r.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function o(){this.name=r.KHR_MATERIALS_UNLIT}function s(e){this.parser=e,this.name=r.KHR_MATERIALS_CLEARCOAT}function u(e){this.parser=e,this.name=r.KHR_MATERIALS_TRANSMISSION}function l(e){this.parser=e,this.name=r.KHR_TEXTURE_BASISU}function c(e){this.parser=e,this.name=r.EXT_TEXTURE_WEBP,this.isSupported=null}function p(e){this.name=r.EXT_MESHOPT_COMPRESSION,this.parser=e}a.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],r=0,n=t.length;r<n;r++){var a=t[r];a.extensions&&a.extensions[this.name]&&void 0!==a.extensions[this.name].light&&e._addNodeRef(this.cache,a.extensions[this.name].light)}},a.prototype._loadLight=function(e){var t=this.parser,r="light:"+e,n=t.cache.get(r);if(n)return n;var a,o=t.json,s=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],u=new i.Color(16777215);void 0!==s.color&&u.fromArray(s.color);var l=void 0!==s.range?s.range:0;switch(s.type){case"directional":(a=new i.DirectionalLight(u)).target.position.set(0,0,-1),a.add(a.target);break;case"point":(a=new i.PointLight(u)).distance=l;break;case"spot":(a=new i.SpotLight(u)).distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),n=Promise.resolve(a),t.cache.add(r,n),n},a.prototype.createNodeAttachment=function(e){var t=this,r=this.parser,n=r.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(e){return r._getNodeRef(t.cache,a,e)}))},o.prototype.getMaterialType=function(){return i.MeshBasicMaterial},o.prototype.extendParams=function(e,t,r){var n=[];e.color=new i.Color(1,1,1),e.opacity=1;var a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){var o=a.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==a.baseColorTexture&&n.push(r.assignTexture(e,"map",a.baseColorTexture))}return Promise.all(n)},s.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null},s.prototype.extendMaterialParams=function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var a=[],o=n.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&a.push(r.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&a.push(r.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(a.push(r.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var s=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new i.Vector2(s,-s)}return Promise.all(a)},u.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null},u.prototype.extendMaterialParams=function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var a=[],i=n.extensions[this.name];return void 0!==i.transmissionFactor&&(t.transmission=i.transmissionFactor),void 0!==i.transmissionTexture&&a.push(r.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(a)},l.prototype.loadTexture=function(e){var t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;var a=n.extensions[this.name],i=r.images[a.source],o=t.options.ktx2Loader;if(!o){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i,o)},c.prototype.loadTexture=function(e){var t=this.name,r=this.parser,n=r.json,a=n.textures[e];if(!a.extensions||!a.extensions[t])return null;var i=a.extensions[t],o=n.images[i.source],s=o.uri?r.options.manager.getHandler(o.uri):r.textureLoader;return this.detectSupport().then((function(a){if(a)return r.loadTextureImage(e,o,s);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))},c.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},p.prototype.loadBufferView=function(e){var t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){var n=r.extensions[this.name],a=this.parser.getDependency("buffer",n.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([a,i.ready]).then((function(e){var t=n.byteOffset||0,r=n.byteLength||0,a=n.count,o=n.byteStride,s=new ArrayBuffer(a*o),u=new Uint8Array(e[0],t,r);return i.decodeGltfBuffer(new Uint8Array(s),a,o,u,n.mode,n.filter),s}))}return null};var h="glTF",f=1313821514,d=5130562;function v(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:i.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=this.header.length-12,a=new DataView(e,12),o=0;o<n;){var s=a.getUint32(o,!0);o+=4;var u=a.getUint32(o,!0);if(o+=4,u===f){var l=new Uint8Array(e,12+o,s);this.content=i.LoaderUtils.decodeText(l)}else if(u===d){var c=12+o;this.body=e.slice(c,c+s)}o+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function m(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function g(){this.name=r.KHR_TEXTURE_TRANSFORM}function y(e){i.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new i.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(var i in s)e.uniforms[i]=s[i];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function x(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return y},extendParams:function(e,t,r){var n=t.extensions[this.name];e.color=new i.Color(1,1,1),e.opacity=1;var a=[];if(Array.isArray(n.diffuseFactor)){var o=n.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==n.diffuseTexture&&a.push(r.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new i.Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new i.Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var s=n.specularGlossinessTexture;a.push(r.assignTexture(e,"glossinessMap",s)),a.push(r.assignTexture(e,"specularMap",s))}return Promise.all(a)},createMaterial:function(e){var t=new y(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=i.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function w(){this.name=r.KHR_MESH_QUANTIZATION}function b(e,t,r,n){i.Interpolant.call(this,e,t,r,n)}m.prototype.decodePrimitive=function(e,t){var r=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,o={},s={},u={};for(var l in i){var c=N[l]||l.toLowerCase();o[c]=i[l]}for(l in e.attributes){c=N[l]||l.toLowerCase();if(void 0!==i[l]){var p=r.accessors[e.attributes[l]],h=L[p.componentType];u[c]=h,s[c]=!0===p.normalized}}return t.getDependency("bufferView",a).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(var r in e.attributes){var n=e.attributes[r],a=s[r];void 0!==a&&(n.normalized=a)}t(e)}),o,u)}))}))},g.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},y.prototype=Object.create(i.MeshStandardMaterial.prototype),y.prototype.constructor=y,y.prototype.copy=function(e){return i.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},b.prototype=Object.create(i.Interpolant.prototype),b.prototype.constructor=b,b.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,a=e*n*3+n,i=0;i!==n;i++)t[i]=r[a+i];return t},b.prototype.beforeStart_=b.prototype.copySampleValue_,b.prototype.afterEnd_=b.prototype.copySampleValue_,b.prototype.interpolate_=function(e,t,r,n){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=2*o,u=3*o,l=n-t,c=(r-t)/l,p=c*c,h=p*c,f=e*u,d=f-u,v=-2*h+3*p,m=h-p,g=1-v,y=m-p+c,x=0;x!==o;x++){var w=i[d+x+o],b=i[d+x+s]*l,T=i[f+x+o],M=i[f+x]*l;a[x]=g*w+y*b+v*T+m*M}return a};var T=0,M=1,S=2,E=3,A=4,R=5,I=6,L={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},O={9728:i.NearestFilter,9729:i.LinearFilter,9984:i.NearestMipmapNearestFilter,9985:i.LinearMipmapNearestFilter,9986:i.NearestMipmapLinearFilter,9987:i.LinearMipmapLinearFilter},C={33071:i.ClampToEdgeWrapping,33648:i.MirroredRepeatWrapping,10497:i.RepeatWrapping},P={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},N={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},_={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},k={CUBICSPLINE:void 0,LINEAR:i.InterpolateLinear,STEP:i.InterpolateDiscrete},D="OPAQUE",F="MASK",U="BLEND";function j(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function B(e,t,r){for(var n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function H(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function G(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var a=t.extras.targetNames;if(e.morphTargetInfluences.length===a.length){e.morphTargetDictionary={};for(r=0,n=a.length;r<n;r++)e.morphTargetDictionary[a[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function V(e){var t=e.extensions&&e.extensions[r.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+z(t.attributes):e.indices+":"+z(e.attributes)+":"+e.mode}function z(e){for(var t="",r=Object.keys(e).sort(),n=0,a=r.length;n<a;n++)t+=r[n]+":"+e[r[n]]+";";return t}function X(e,r){this.json=e||{},this.extensions={},this.plugins={},this.options=r||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new i.ImageBitmapLoader(this.options.manager):this.textureLoader=new i.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new i.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function K(e,t,r){var n=t.attributes,a=[];function o(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(var s in n){var u=N[s]||s.toLowerCase();u in e.attributes||a.push(o(n[s],u))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(l)}return H(e,t),function(e,t,r){var n=t.attributes,a=new i.Box3;if(void 0!==n.POSITION){var o=(f=r.json.accessors[n.POSITION]).min,s=f.max;if(void 0!==o&&void 0!==s){a.set(new i.Vector3(o[0],o[1],o[2]),new i.Vector3(s[0],s[1],s[2]));var u=t.targets;if(void 0!==u){for(var l=new i.Vector3,c=new i.Vector3,p=0,h=u.length;p<h;p++){var f,d=u[p];if(void 0!==d.POSITION)o=(f=r.json.accessors[d.POSITION]).min,s=f.max,void 0!==o&&void 0!==s?(c.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),c.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),c.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),l.max(c)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}a.expandByVector(l)}e.boundingBox=a;var v=new i.Sphere;a.getCenter(v.center),v.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=v}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,r),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,r){for(var n=!1,a=!1,i=0,o=t.length;i<o&&(void 0!==(l=t[i]).POSITION&&(n=!0),void 0!==l.NORMAL&&(a=!0),!n||!a);i++);if(!n&&!a)return Promise.resolve(e);var s=[],u=[];for(i=0,o=t.length;i<o;i++){var l=t[i];if(n){var c=void 0!==l.POSITION?r.getDependency("accessor",l.POSITION):e.attributes.position;s.push(c)}a&&(c=void 0!==l.NORMAL?r.getDependency("accessor",l.NORMAL):e.attributes.normal,u.push(c))}return Promise.all([Promise.all(s),Promise.all(u)]).then((function(t){var r=t[0],i=t[1];return n&&(e.morphAttributes.position=r),a&&(e.morphAttributes.normal=i),e.morphTargetsRelative=!0,e}))}(e,t.targets,r):e}))}function W(e,t){var r=e.getIndex();if(null===r){var n=[],a=e.getAttribute("position");if(void 0===a)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<a.count;o++)n.push(o);e.setIndex(n),r=e.getIndex()}var s=r.count-2,u=[];if(t===i.TriangleFanDrawMode)for(o=1;o<=s;o++)u.push(r.getX(0)),u.push(r.getX(o)),u.push(r.getX(o+1));else for(o=0;o<s;o++)o%2===0?(u.push(r.getX(o)),u.push(r.getX(o+1)),u.push(r.getX(o+2))):(u.push(r.getX(o+2)),u.push(r.getX(o+1)),u.push(r.getX(o)));u.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(u),l}return X.prototype.setExtensions=function(e){this.extensions=e},X.prototype.setPlugins=function(e){this.plugins=e},X.prototype.parse=function(e,t){var r=this,n=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var i={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};B(a,i,n),H(i,n),e(i)})).catch(t)},X.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n=0,a=t.length;n<a;n++)for(var i=t[n].joints,o=0,s=i.length;o<s;o++)e[i[o]].isBone=!0;for(var u=0,l=e.length;u<l;u++){var c=e[u];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(r[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}},X.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},X.prototype._getNodeRef=function(e,t,r){if(e.refs[t]<=1)return r;var n=r.clone();return n.name+="_instance_"+e.uses[t]++,n},X.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var r=0;r<t.length;r++){var n=e(t[r]);if(n)return n}},X.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var r=[],n=0;n<t.length;n++){var a=e(t[n]);a&&r.push(a)}return r},X.prototype.getDependency=function(e,t){var r=e+":"+t,n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n},X.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t},X.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var a=this.options;return new Promise((function(e,r){n.load(j(t.uri,a.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},X.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))},X.prototype.loadAccessor=function(e){var t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var a=[];return void 0!==n.bufferView?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),void 0!==n.sparse&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then((function(e){var a,o,s=e[0],u=P[n.type],l=L[n.componentType],c=l.BYTES_PER_ELEMENT,p=c*u,h=n.byteOffset||0,f=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,d=!0===n.normalized;if(f&&f!==p){var v=Math.floor(h/f),m="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+v+":"+n.count,g=t.cache.get(m);g||(a=new l(s,v*f,n.count*f/c),g=new i.InterleavedBuffer(a,f/c),t.cache.add(m,g)),o=new i.InterleavedBufferAttribute(g,u,h%f/c,d)}else a=null===s?new l(n.count*u):new l(s,h,n.count*u),o=new i.BufferAttribute(a,u,d);if(void 0!==n.sparse){var y=P.SCALAR,x=L[n.sparse.indices.componentType],w=n.sparse.indices.byteOffset||0,b=n.sparse.values.byteOffset||0,T=new x(e[1],w,n.sparse.count*y),M=new l(e[2],b,n.sparse.count*u);null!==s&&(o=new i.BufferAttribute(o.array.slice(),o.itemSize,o.normalized));for(var S=0,E=T.length;S<E;S++){var A=T[S];if(o.setX(A,M[S*u]),u>=2&&o.setY(A,M[S*u+1]),u>=3&&o.setZ(A,M[S*u+2]),u>=4&&o.setW(A,M[S*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},X.prototype.loadTexture=function(e){var t,n,a=this.json,i=this.options,o=a.textures[e],s=o.extensions||{};return(t=s[r.MSFT_TEXTURE_DDS]?a.images[s[r.MSFT_TEXTURE_DDS].source]:a.images[o.source]).uri&&(n=i.manager.getHandler(t.uri)),n||(n=s[r.MSFT_TEXTURE_DDS]?this.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,t,n)},X.prototype.loadTextureImage=function(e,t,r){var n=this,a=this.json,o=this.options,s=a.textures[e],u=self.URL||self.webkitURL,l=t.uri,c=!1,p=!0;return"image/jpeg"===t.mimeType&&(p=!1),void 0!==t.bufferView&&(l=n.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var r=new DataView(e,25,1).getUint8(0,!1);p=6===r||4===r||3===r}c=!0;var n=new Blob([e],{type:t.mimeType});return l=u.createObjectURL(n)}))),Promise.resolve(l).then((function(e){return new Promise((function(t,n){var a=t;!0===r.isImageBitmapLoader&&(a=function(e){t(new i.CanvasTexture(e))}),r.load(j(e,o.path),a,void 0,n)}))})).then((function(t){!0===c&&u.revokeObjectURL(l),t.flipY=!1,s.name&&(t.name=s.name),p||(t.format=i.RGBFormat);var r=(a.samplers||{})[s.sampler]||{};return t.magFilter=O[r.magFilter]||i.LinearFilter,t.minFilter=O[r.minFilter]||i.LinearMipmapLinearFilter,t.wrapS=C[r.wrapS]||i.RepeatWrapping,t.wrapT=C[r.wrapT]||i.RepeatWrapping,n.associations.set(t,{type:"textures",index:e}),t}))},X.prototype.assignTexture=function(e,t,n){var a=this;return this.getDependency("texture",n.index).then((function(i){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),a.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var s=a.associations.get(i);i=a.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(i,o),a.associations.set(i,s)}}e[t]=i}))},X.prototype.assignFinalMaterial=function(e){var t=e.geometry,r=e.material,n=void 0!==t.attributes.tangent,a=void 0!==t.attributes.color,o=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,u=Object.keys(t.morphAttributes).length>0,l=u&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+r.uuid,p=this.cache.get(c);p||(p=new i.PointsMaterial,i.Material.prototype.copy.call(p,r),p.color.copy(r.color),p.map=r.map,p.sizeAttenuation=!1,this.cache.add(c,p)),r=p}else if(e.isLine){c="LineBasicMaterial:"+r.uuid;var h=this.cache.get(c);h||(h=new i.LineBasicMaterial,i.Material.prototype.copy.call(h,r),h.color.copy(r.color),this.cache.add(c,h)),r=h}if(n||a||o||s||u){c="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),s&&(c+="skinning:"),n&&(c+="vertex-tangents:"),a&&(c+="vertex-colors:"),o&&(c+="flat-shading:"),u&&(c+="morph-targets:"),l&&(c+="morph-normals:");var f=this.cache.get(c);f||(f=r.clone(),s&&(f.skinning=!0),a&&(f.vertexColors=!0),o&&(f.flatShading=!0),u&&(f.morphTargets=!0),l&&(f.morphNormals=!0),n&&(f.vertexTangents=!0,f.normalScale&&(f.normalScale.y*=-1),f.clearcoatNormalScale&&(f.clearcoatNormalScale.y*=-1)),this.cache.add(c,f),this.associations.set(f,this.associations.get(r))),r=f}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r},X.prototype.getMaterialType=function(){return i.MeshStandardMaterial},X.prototype.loadMaterial=function(e){var t,n=this,a=this.json,o=this.extensions,s=a.materials[e],u={},l=s.extensions||{},c=[];if(l[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var p=o[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=p.getMaterialType(),c.push(p.extendParams(u,s,n))}else if(l[r.KHR_MATERIALS_UNLIT]){var h=o[r.KHR_MATERIALS_UNLIT];t=h.getMaterialType(),c.push(h.extendParams(u,s,n))}else{var f=s.pbrMetallicRoughness||{};if(u.color=new i.Color(1,1,1),u.opacity=1,Array.isArray(f.baseColorFactor)){var d=f.baseColorFactor;u.color.fromArray(d),u.opacity=d[3]}void 0!==f.baseColorTexture&&c.push(n.assignTexture(u,"map",f.baseColorTexture)),u.metalness=void 0!==f.metallicFactor?f.metallicFactor:1,u.roughness=void 0!==f.roughnessFactor?f.roughnessFactor:1,void 0!==f.metallicRoughnessTexture&&(c.push(n.assignTexture(u,"metalnessMap",f.metallicRoughnessTexture)),c.push(n.assignTexture(u,"roughnessMap",f.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,u)}))))}!0===s.doubleSided&&(u.side=i.DoubleSide);var v=s.alphaMode||D;return v===U?(u.transparent=!0,u.depthWrite=!1):(u.transparent=!1,v===F&&(u.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==i.MeshBasicMaterial&&(c.push(n.assignTexture(u,"normalMap",s.normalTexture)),u.normalScale=new i.Vector2(1,-1),void 0!==s.normalTexture.scale&&u.normalScale.set(s.normalTexture.scale,-s.normalTexture.scale)),void 0!==s.occlusionTexture&&t!==i.MeshBasicMaterial&&(c.push(n.assignTexture(u,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(u.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==i.MeshBasicMaterial&&(u.emissive=(new i.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==i.MeshBasicMaterial&&c.push(n.assignTexture(u,"emissiveMap",s.emissiveTexture)),Promise.all(c).then((function(){var a;return a=t===y?o[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(u):new t(u),s.name&&(a.name=s.name),a.map&&(a.map.encoding=i.sRGBEncoding),a.emissiveMap&&(a.emissiveMap.encoding=i.sRGBEncoding),H(a,s),n.associations.set(a,{type:"materials",index:e}),s.extensions&&B(o,a,s),a}))},X.prototype.createUniqueName=function(e){for(var t=i.PropertyBinding.sanitizeNodeName(e||""),r=t,n=1;this.nodeNamesUsed[r];++n)r=t+"_"+n;return this.nodeNamesUsed[r]=!0,r},X.prototype.loadGeometries=function(e){var t=this,n=this.extensions,a=this.primitiveCache;function o(e){return n[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(r){return K(r,e,t)}))}for(var s=[],u=0,l=e.length;u<l;u++){var c,p=e[u],h=V(p),f=a[h];if(f)s.push(f.promise);else c=p.extensions&&p.extensions[r.KHR_DRACO_MESH_COMPRESSION]?o(p):K(new i.BufferGeometry,p,t),a[h]={primitive:p,promise:c},s.push(c)}return Promise.all(s)},X.prototype.loadMesh=function(e){for(var t,r=this,n=this.json,a=this.extensions,o=n.meshes[e],s=o.primitives,u=[],l=0,c=s.length;l<c;l++){var p=void 0===s[l].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new i.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:i.FrontSide})),t.DefaultMaterial):this.getDependency("material",s[l].material);u.push(p)}return u.push(r.loadGeometries(s)),Promise.all(u).then((function(t){for(var n=t.slice(0,t.length-1),u=t[t.length-1],l=[],c=0,p=u.length;c<p;c++){var h,f=u[c],d=s[c],v=n[c];if(d.mode===A||d.mode===R||d.mode===I||void 0===d.mode)h=!0===o.isSkinnedMesh?new i.SkinnedMesh(f,v):new i.Mesh(f,v),!0===v.isMeshStandardMaterial&&v.side===i.DoubleSide&&null!==f.getIndex()&&!0===f.hasAttribute("position")&&!0===f.hasAttribute("normal")&&!0===f.hasAttribute("uv")&&!1===f.hasAttribute("tangent")&&(f.computeTangents(),v.vertexTangents=!0),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),d.mode===R?h.geometry=W(h.geometry,i.TriangleStripDrawMode):d.mode===I&&(h.geometry=W(h.geometry,i.TriangleFanDrawMode));else if(d.mode===M)h=new i.LineSegments(f,v);else if(d.mode===E)h=new i.Line(f,v);else if(d.mode===S)h=new i.LineLoop(f,v);else{if(d.mode!==T)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);h=new i.Points(f,v)}Object.keys(h.geometry.morphAttributes).length>0&&G(h,o),h.name=r.createUniqueName(o.name||"mesh_"+e),H(h,o),d.extensions&&B(a,h,d),r.assignFinalMaterial(h),l.push(h)}if(1===l.length)return l[0];var m=new i.Group;for(c=0,p=l.length;c<p;c++)m.add(l[c]);return m}))},X.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new i.PerspectiveCamera(i.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new i.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),H(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},X.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))},X.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],n=[],a=[],o=[],s=[],u=0,l=t.channels.length;u<l;u++){var c=t.channels[u],p=t.samplers[c.sampler],h=c.target,f=void 0!==h.node?h.node:h.id,d=void 0!==t.parameters?t.parameters[p.input]:p.input,v=void 0!==t.parameters?t.parameters[p.output]:p.output;r.push(this.getDependency("node",f)),n.push(this.getDependency("accessor",d)),a.push(this.getDependency("accessor",v)),o.push(p),s.push(h)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(a),Promise.all(o),Promise.all(s)]).then((function(r){for(var n=r[0],a=r[1],o=r[2],s=r[3],u=r[4],l=[],c=0,p=n.length;c<p;c++){var h=n[c],f=a[c],d=o[c],v=s[c],m=u[c];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,_[m.path]){case _.weights:g=i.NumberKeyframeTrack;break;case _.rotation:g=i.QuaternionKeyframeTrack;break;case _.position:case _.scale:default:g=i.VectorKeyframeTrack}var y=h.name?h.name:h.uuid,x=void 0!==v.interpolation?k[v.interpolation]:i.InterpolateLinear,w=[];_[m.path]===_.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&w.push(e.name?e.name:e.uuid)})):w.push(y);var T=d.array;if(d.normalized){var M;if(T.constructor===Int8Array)M=1/127;else if(T.constructor===Uint8Array)M=1/255;else if(T.constructor==Int16Array)M=1/32767;else{if(T.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");M=1/65535}for(var S=new Float32Array(T.length),E=0,A=T.length;E<A;E++)S[E]=T[E]*M;T=S}for(E=0,A=w.length;E<A;E++){var R=new g(w[E]+"."+_[m.path],f.array,T,x);"CUBICSPLINE"===v.interpolation&&(R.createInterpolant=function(e){return new b(this.times,this.values,this.getValueSize()/3,e)},R.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(R)}}}var I=t.name?t.name:"animation_"+e;return new i.AnimationClip(I,void 0,l)}))},X.prototype.loadNode=function(e){var t=this.json,r=this.extensions,n=this,a=t.nodes[e],o=a.name?n.createUniqueName(a.name):"";return function(){var t=[];return void 0!==a.mesh&&t.push(n.getDependency("mesh",a.mesh).then((function(e){var t=n._getNodeRef(n.meshCache,a.mesh,e);return void 0!==a.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,r=a.weights.length;t<r;t++)e.morphTargetInfluences[t]=a.weights[t]})),t}))),void 0!==a.camera&&t.push(n.getDependency("camera",a.camera).then((function(e){return n._getNodeRef(n.cameraCache,a.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){var s;if((s=!0===a.isBone?new i.Bone:t.length>1?new i.Group:1===t.length?t[0]:new i.Object3D)!==t[0])for(var u=0,l=t.length;u<l;u++)s.add(t[u]);if(a.name&&(s.userData.name=a.name,s.name=o),H(s,a),a.extensions&&B(r,s,a),void 0!==a.matrix){var c=new i.Matrix4;c.fromArray(a.matrix),s.applyMatrix4(c)}else void 0!==a.translation&&s.position.fromArray(a.translation),void 0!==a.rotation&&s.quaternion.fromArray(a.rotation),void 0!==a.scale&&s.scale.fromArray(a.scale);return n.associations.set(s,{type:"nodes",index:e}),s}))},X.prototype.loadScene=function(){function e(t,r,n,a){var o=n.nodes[t];return a.getDependency("node",t).then((function(e){return void 0===o.skin?e:a.getDependency("skin",o.skin).then((function(e){for(var r=[],n=0,i=(t=e).joints.length;n<i;n++)r.push(a.getDependency("node",t.joints[n]));return Promise.all(r)})).then((function(r){return e.traverse((function(e){if(e.isMesh){for(var n=[],a=[],o=0,s=r.length;o<s;o++){var u=r[o];if(u){n.push(u);var l=new i.Matrix4;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*o),a.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new i.Skeleton(n,a),e.matrixWorld)}})),e}));var t})).then((function(t){r.add(t);var i=[];if(o.children)for(var s=o.children,u=0,l=s.length;u<l;u++){var c=s[u];i.push(e(c,t,n,a))}return Promise.all(i)}))}return function(t){var r=this.json,n=this.extensions,a=this.json.scenes[t],o=new i.Group;a.name&&(o.name=this.createUniqueName(a.name)),H(o,a),a.extensions&&B(n,o,a);for(var s=a.nodes||[],u=[],l=0,c=s.length;l<c;l++)u.push(e(s[l],o,r,this));return Promise.all(u).then((function(){return o}))}}(),e}();const s={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function u(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}async function l(e,t,r=null,n=!0){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const a=await async function(e){if(!e)throw new Error("No basePath supplied");return await u(`${e}/profilesList.json`)}(t);let i;if(e.profiles.some((e=>{const r=a[e];return r&&(i={profileId:e,profilePath:`${t}/${r.path}`,deprecated:!!r.deprecated}),!!i})),!i){if(!r)throw new Error("No matching profile name found");const e=a[r];if(!e)throw new Error(`No matching profile name found and default profile "${r}" missing.`);i={profileId:r,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const o=await u(i.profilePath);let s;if(n){let t;if(t="any"===e.handedness?o.layouts[Object.keys(o.layouts)[0]]:o.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${i.profileId}`);t.assetPath&&(s=i.profilePath.replace("profile.json",t.assetPath))}return{profile:o,assetPath:s}}const c={xAxis:0,yAxis:0,button:0,state:s.ComponentState.DEFAULT};class p{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===s.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(c)}updateFromComponent({xAxis:e,yAxis:t,button:r,state:n}){const{normalizedXAxis:a,normalizedYAxis:i}=function(e=0,t=0){let r=e,n=t;if(Math.sqrt(e*e+t*t)>1){const a=Math.atan2(t,e);r=Math.cos(a),n=Math.sin(a)}return{normalizedXAxis:.5*r+.5,normalizedYAxis:.5*n+.5}}(e,t);switch(this.componentProperty){case s.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?a:.5;break;case s.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?i:.5;break;case s.ComponentProperty.BUTTON:this.value=this.states.includes(n)?r:0;break;case s.ComponentProperty.STATE:this.valueNodeProperty===s.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class h{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||0===Object.keys(t.gamepadIndices).length)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach((e=>{const r=new p(t.visualResponses[e]);this.visualResponses[e]=r})),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:s.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=s.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=s.ComponentState.PRESSED:(t.touched||this.values.button>s.ButtonTouchThreshold)&&(this.values.state=s.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===s.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>s.AxisTouchThreshold&&(this.values.state=s.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===s.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>s.AxisTouchThreshold&&(this.values.state=s.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((e=>{e.updateFromComponent(this.values)}))}}class f{constructor(e,t,r){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=r,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((e=>{const t=this.layoutDescription.components[e];this.components[e]=new h(e,t)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach((t=>{e.push(t.data)})),e}updateFromGamepad(){Object.values(this.components).forEach((e=>{e.updateFromGamepad(this.xrInputSource.gamepad)}))}}function d(){i.Object3D.call(this),this.motionController=null,this.envMap=null}function v(e,t){!function(e,t){Object.values(e.components).forEach((e=>{const{type:r,touchPointNodeName:n,visualResponses:a}=e;if(r===s.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(n),e.touchPointNode){const t=new i.SphereGeometry(.001),r=new i.MeshBasicMaterial({color:255}),n=new i.Mesh(t,r);e.touchPointNode.add(n)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(a).forEach((e=>{const{valueNodeName:r,minNodeName:n,maxNodeName:a,valueNodeProperty:i}=e;if(i===s.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(n),e.maxNode=t.getObjectByName(a),!e.minNode)return void console.warn(`Could not find ${n} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${a} in the model`)}e.valueNode=t.getObjectByName(r),e.valueNode||console.warn(`Could not find ${r} in the model`)}))}))}(e.motionController,t),e.envMap&&t.traverse((t=>{t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)})),e.add(t)}d.prototype=Object.assign(Object.create(i.Object3D.prototype),{constructor:d,setEnvironmentMap:function(e){return this.envMap==e||(this.envMap=e,this.traverse((e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}))),this},updateMatrixWorld:function(e){i.Object3D.prototype.updateMatrixWorld.call(this,e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((e=>{Object.values(e.visualResponses).forEach((e=>{const{valueNode:t,minNode:r,maxNode:n,value:a,valueNodeProperty:o}=e;t&&(o===s.VisualResponseProperty.VISIBILITY?t.visible=a:o===s.VisualResponseProperty.TRANSFORM&&(i.Quaternion.slerp(r.quaternion,n.quaternion,t.quaternion,a),t.position.lerpVectors(r.position,n.position,a)))}))})))}});var m=function(){function e(e=null){this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new o)}return e.prototype={constructor:e,createControllerModel:function(e){const t=new d;let r=null;return e.addEventListener("connected",(e=>{const n=e.data;"tracked-pointer"===n.targetRayMode&&n.gamepad&&l(n,this.path,"generic-trigger").then((({profile:e,assetPath:a})=>{t.motionController=new f(n,e,a);const i=this._assetCache[t.motionController.assetUrl];if(i)r=i.scene.clone(),v(t,r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,(e=>{this._assetCache[t.motionController.assetUrl]=e,r=e.scene.clone(),v(t,r)}),null,(()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)}))}})).catch((e=>{console.warn(e)}))})),e.addEventListener("disconnected",(()=>{t.motionController=null,t.remove(r),r=null})),t}},e}(),g=r("zLVn"),y=r("q1tI"),x=r.n(y),w=r("MHn+");var b=r("LFnd");class T{constructor(e,t,r,n,a){if(this.controller=t,this.handModel=e,this.envMap=null,this.handMesh=new i.Group,this.handModel.add(this.handMesh),window.XRHand){let e;a&&a.primitive&&"sphere"!==a.primitive?"box"===a.primitive&&(e=new i.BoxGeometry(1,1,1)):e=new i.SphereGeometry(1,10,10);const t=new i.MeshStandardMaterial({color:16777215,roughness:1,metalness:0}),r=new i.MeshStandardMaterial({color:10066329,roughness:1,metalness:0}),n=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"];for(const a of n){var o=new i.Mesh(e,-1!==a.indexOf("tip")?r:t);o.castShadow=!0,o.receiveShadow=!0,o.jointName=a,this.handMesh.add(o)}}}updateMesh(){const e=this.handMesh.children,t=this.controller.joints;for(let r=0;r<e.length;r++){const n=e[r],a=t[n.jointName];a.visible&&(n.position.copy(a.position),n.quaternion.copy(a.quaternion),n.scale.setScalar(a.jointRadius||.008)),n.visible=a.visible}}}var M={},S=Uint8Array,E=Uint16Array,A=Uint32Array,R=new S([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),I=new S([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),L=new S([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),O=function(e,t){for(var r=new E(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var a=new A(r[30]);for(n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)a[i]=i-r[n]<<5|n;return[r,a]},C=O(R,2),P=C[0],N=C[1];P[28]=258,N[258]=28;for(var _=O(I,0),k=_[0],D=_[1],F=new E(32768),U=0;U<32768;++U){var j=(43690&U)>>>1|(21845&U)<<1;j=(61680&(j=(52428&j)>>>2|(13107&j)<<2))>>>4|(3855&j)<<4,F[U]=((65280&j)>>>8|(255&j)<<8)>>>1}var B=function(e,t,r){for(var n=e.length,a=0,i=new E(t);a<n;++a)++i[e[a]-1];var o,s=new E(t);for(a=0;a<t;++a)s[a]=s[a-1]+i[a-1]<<1;if(r){o=new E(1<<t);var u=15-t;for(a=0;a<n;++a)if(e[a])for(var l=a<<4|e[a],c=t-e[a],p=s[e[a]-1]++<<c,h=p|(1<<c)-1;p<=h;++p)o[F[p]>>>u]=l}else for(o=new E(n),a=0;a<n;++a)o[a]=F[s[e[a]-1]++]>>>15-e[a];return o},H=new S(288);for(U=0;U<144;++U)H[U]=8;for(U=144;U<256;++U)H[U]=9;for(U=256;U<280;++U)H[U]=7;for(U=280;U<288;++U)H[U]=8;var G=new S(32);for(U=0;U<32;++U)G[U]=5;var V=B(H,9,0),z=B(H,9,1),X=B(G,5,0),K=B(G,5,1),W=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},q=function(e,t,r){var n=t/8>>0;return(e[n]|e[n+1]<<8)>>>(7&t)&r},Y=function(e,t){var r=t/8>>0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>>(7&t)},$=function(e){return(e/8>>0)+(7&e&&1)},Z=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof E?E:e instanceof A?A:S)(r-t);return n.set(e.subarray(t,r)),n},Q=function(e,t,r){var n=e.length,a=!t||r,i=!r||r.i;r||(r={}),t||(t=new S(3*n));var o=function(e){var r=t.length;if(e>r){var n=new S(Math.max(2*r,e));n.set(t),t=n}},s=r.f||0,u=r.p||0,l=r.b||0,c=r.l,p=r.d,h=r.m,f=r.n,d=8*n;do{if(!c){r.f=s=q(e,u,1);var v=q(e,u+1,3);if(u+=3,!v){var m=e[(C=$(u)+4)-4]|e[C-3]<<8,g=C+m;if(g>n){if(i)throw"unexpected EOF";break}a&&o(l+m),t.set(e.subarray(C,g),l),r.b=l+=m,r.p=u=8*g;continue}if(1==v)c=z,p=K,h=9,f=5;else{if(2!=v)throw"invalid block type";var y=q(e,u,31)+257,x=q(e,u+10,15)+4,w=y+q(e,u+5,31)+1;u+=14;for(var b=new S(w),T=new S(19),M=0;M<x;++M)T[L[M]]=q(e,u+3*M,7);u+=3*x;var E=W(T),A=(1<<E)-1;if(!i&&u+w*(E+7)>d)break;var O=B(T,E,1);for(M=0;M<w;){var C,N=O[q(e,u,A)];if(u+=15&N,(C=N>>>4)<16)b[M++]=C;else{var _=0,D=0;for(16==C?(D=3+q(e,u,3),u+=2,_=b[M-1]):17==C?(D=3+q(e,u,7),u+=3):18==C&&(D=11+q(e,u,127),u+=7);D--;)b[M++]=_}}var F=b.subarray(0,y),U=b.subarray(y);h=W(F),f=W(U),c=B(F,h,1),p=B(U,f,1)}if(u>d)throw"unexpected EOF"}a&&o(l+131072);for(var j=(1<<h)-1,H=(1<<f)-1,G=h+f+18;i||u+G<d;){var V=(_=c[Y(e,u)&j])>>>4;if((u+=15&_)>d)throw"unexpected EOF";if(!_)throw"invalid length/literal";if(V<256)t[l++]=V;else{if(256==V){c=null;break}var X=V-254;if(V>264){var Q=R[M=V-257];X=q(e,u,(1<<Q)-1)+P[M],u+=Q}var J=p[Y(e,u)&H],ee=J>>>4;if(!J)throw"invalid distance";if(u+=15&J,U=k[ee],ee>3&&(Q=I[ee],U+=Y(e,u)&(1<<Q)-1,u+=Q),u>d)throw"unexpected EOF";a&&o(l+131072);for(var te=l+X;l<te;l+=4)t[l]=t[l-U],t[l+1]=t[l+1-U],t[l+2]=t[l+2-U],t[l+3]=t[l+3-U];l=te}}r.l=c,r.p=u,r.b=l,c&&(s=1,r.m=h,r.d=p,r.n=f)}while(!s);return l==t.length?t:Z(t,0,l)},J=function(e,t,r){r<<=7&t;var n=t/8>>0;e[n]|=r,e[n+1]|=r>>>8},ee=function(e,t,r){r<<=7&t;var n=t/8>>0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},te=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,i=r.slice();if(!a)return[new S(0),0];if(1==a){var o=new S(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort((function(e,t){return e.f-t.f})),r.push({s:-1,f:25001});var s=r[0],u=r[1],l=0,c=1,p=2;for(r[0]={s:-1,f:s.f+u.f,l:s,r:u};c!=a-1;)s=r[r[l].f<r[p].f?l++:p++],u=r[l!=c&&r[l].f<r[p].f?l++:p++],r[c++]={s:-1,f:s.f+u.f,l:s,r:u};var h=i[0].s;for(n=1;n<a;++n)i[n].s>h&&(h=i[n].s);var f=new E(h+1),d=re(r[c-1],f,0);if(d>t){n=0;var v=0,m=d-t,g=1<<m;for(i.sort((function(e,t){return f[t.s]-f[e.s]||e.f-t.f}));n<a;++n){var y=i[n].s;if(!(f[y]>t))break;v+=g-(1<<d-f[y]),f[y]=t}for(v>>>=m;v>0;){var x=i[n].s;f[x]<t?v-=1<<t-f[x]++-1:++n}for(;n>=0&&v;--n){var w=i[n].s;f[w]==t&&(--f[w],++v)}d=t}return[new S(f),d]},re=function(e,t,r){return-1==e.s?Math.max(re(e.l,t,r+1),re(e.r,t,r+1)):t[e.s]=r},ne=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new E(++t),n=0,a=e[0],i=1,o=function(e){r[n++]=e},s=1;s<=t;++s)if(e[s]==a&&s!=t)++i;else{if(!a&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(a),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(a);i=1,a=e[s]}return[r.subarray(0,n),t]},ae=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},ie=function(e,t,r){var n=r.length,a=$(t+2);e[a]=255&n,e[a+1]=n>>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var i=0;i<n;++i)e[a+i+4]=r[i];return 8*(a+4+n)},oe=function(e,t,r,n,a,i,o,s,u,l,c){J(t,c++,r),++a[256];for(var p=te(a,15),h=p[0],f=p[1],d=te(i,15),v=d[0],m=d[1],g=ne(h),y=g[0],x=g[1],w=ne(v),b=w[0],T=w[1],M=new E(19),S=0;S<y.length;++S)M[31&y[S]]++;for(S=0;S<b.length;++S)M[31&b[S]]++;for(var A=te(M,7),O=A[0],C=A[1],P=19;P>4&&!O[L[P-1]];--P);var N,_,k,D,F=l+5<<3,U=ae(a,H)+ae(i,G)+o,j=ae(a,h)+ae(i,v)+o+14+3*P+ae(M,O)+(2*M[16]+3*M[17]+7*M[18]);if(F<=U&&F<=j)return ie(t,c,e.subarray(u,u+l));if(J(t,c,1+(j<U)),c+=2,j<U){N=B(h,f,0),_=h,k=B(v,m,0),D=v;var z=B(O,C,0);for(J(t,c,x-257),J(t,c+5,T-1),J(t,c+10,P-4),c+=14,S=0;S<P;++S)J(t,c+3*S,O[L[S]]);c+=3*P;for(var K=[y,b],W=0;W<2;++W){var q=K[W];for(S=0;S<q.length;++S){var Y=31&q[S];J(t,c,z[Y]),c+=O[Y],Y>15&&(J(t,c,q[S]>>>5&127),c+=q[S]>>>12)}}}else N=V,_=H,k=X,D=G;for(S=0;S<s;++S)if(n[S]>255){Y=n[S]>>>18&31,ee(t,c,N[Y+257]),c+=_[Y+257],Y>7&&(J(t,c,n[S]>>>23&31),c+=R[Y]);var $=31&n[S];ee(t,c,k[$]),c+=D[$],$>3&&(ee(t,c,n[S]>>>5&8191),c+=I[$])}else ee(t,c,N[n[S]]),c+=_[n[S]];return ee(t,c,N[256]),c+_[256]},se=new A([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ue=new S(0),le=function(e,t,r,n,a,i){var o=e.length,s=new S(n+o+5*(1+Math.ceil(o/7e3))+a),u=s.subarray(n,s.length-a),l=0;if(!t||o<8)for(var c=0;c<=o;c+=65535){var p=c+65535;p<o?l=ie(u,l,e.subarray(c,p)):(u[c]=i,l=ie(u,l,e.subarray(c,o)))}else{for(var h=se[t-1],f=h>>>13,d=8191&h,v=(1<<r)-1,m=new E(32768),g=new E(v+1),y=Math.ceil(r/3),x=2*y,w=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<x)&v},b=new A(25e3),T=new E(288),M=new E(32),L=0,O=0,C=(c=0,0),P=0,_=0;c<o;++c){var k=w(c),F=32767&c,U=g[k];if(m[F]=U,g[k]=F,P<=c){var j=o-c;if((L>7e3||C>24576)&&j>423){l=oe(e,u,0,b,T,M,O,C,_,c-_,l),C=L=O=0,_=c;for(var B=0;B<286;++B)T[B]=0;for(B=0;B<30;++B)M[B]=0}var H=2,G=0,V=d,z=F-U&32767;if(j>2&&k==w(c-z))for(var X=Math.min(f,j)-1,K=Math.min(32767,c),W=Math.min(258,j);z<=K&&--V&&F!=U;){if(e[c+H]==e[c+H-z]){for(var q=0;q<W&&e[c+q]==e[c+q-z];++q);if(q>H){if(H=q,G=z,q>X)break;var Y=Math.min(z,q-2),Q=0;for(B=0;B<Y;++B){var J=c-z+B+32768&32767,ee=J-m[J]+32768&32767;ee>Q&&(Q=ee,U=J)}}}z+=(F=U)-(U=m[F])+32768&32767}if(G){b[C++]=268435456|N[H]<<18|D[G];var te=31&N[H],re=31&D[G];O+=R[te]+I[re],++T[257+te],++M[re],P=c+H,++L}else b[C++]=e[c],++T[e[c]]}}l=oe(e,u,i,b,T,M,O,C,_,c-_,l),!i&&7&l&&(l=ie(u,l+1,ue))}return Z(s,0,n+$(l)+a)},ce=function(){for(var e=new A(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&3988292384)^r>>>1;e[t]=r}return e}(),pe=function(){var e=4294967295;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=ce[255&r^t[n]]^r>>>8;e=r},d:function(){return 4294967295^e}}},he=function(){var e=1,t=0;return{p:function(r){for(var n=e,a=t,i=r.length,o=0;o!=i;){for(var s=Math.min(o+5552,i);o<s;++o)a+=n+=r[o];n%=65521,a%=65521}e=n,t=a},d:function(){return(e>>>8<<16|(255&t)<<8|t>>>8)+2*((255&e)<<23)}}},fe=function(e,t,r,n,a){return le(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,n,!a)},de=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},ve=function(e,t,r){for(var n=e(),a=e.toString(),i=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var s=n[o],u=i[o];if("function"==typeof s){t+=";"+u+"=";var l=s.toString();if(s.prototype)if(-1!=l.indexOf("[native code]")){var c=l.indexOf(" ",8)+1;t+=l.slice(c,l.indexOf("(",c))}else for(var p in t+=l,s.prototype)t+=";"+u+".prototype."+p+"="+s.prototype[p].toString();else t+=l}else r[u]=s}return[t,r]},me=[],ge=function(e,t,r,n){var a;if(!me[r]){for(var i="",o={},s=e.length-1,u=0;u<s;++u)i=(a=ve(e[u],i,o))[0],o=a[1];me[r]=ve(e[s],i,o)}var l=de({},me[r][1]);return function(e,t,r,n,a){var i=M[t]||(M[t]=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))),o=new Worker(i);return o.onerror=function(e){a(e.error,null)},o.onmessage=function(e){a(null,e.data)},o.postMessage(r,n),o}(me[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,l,function(e){var t=[];for(var r in e)(e[r]instanceof S||e[r]instanceof E||e[r]instanceof A)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t}(l),n)},ye=function(){return[S,E,A,R,I,L,P,k,z,K,F,B,W,q,Y,$,Z,Q,We,Se,Ee]},xe=function(){return[S,E,A,R,I,L,N,D,V,H,X,G,F,se,ue,B,J,ee,te,re,ne,ae,ie,oe,$,Z,le,fe,Ve,Se]},we=function(){return[Ne,De,Pe,pe,ce]},be=function(){return[_e,ke]},Te=function(){return[Fe,Pe,he]},Me=function(){return[Ue]},Se=function(e){return postMessage(e,[e.buffer])},Ee=function(e){return e&&e.size&&new S(e.size)},Ae=function(e,t,r,n,a,i){var o=ge(r,n,a,(function(e,t){o.terminate(),i(e,t)}));return t.consume||(e=new S(e)),o.postMessage([e,t],[e.buffer]),function(){o.terminate()}},Re=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},Ie=function(e,t,r,n,a){var i,o=ge(e,n,a,(function(e,r){e?(o.terminate(),t.ondata.call(t,e)):(r[1]&&o.terminate(),t.ondata.call(t,e,r[0],r[1]))}));o.postMessage(r),t.push=function(e,r){if(i)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,i=r],[e.buffer])},t.terminate=function(){o.terminate()}},Le=function(e,t){return e[t]|e[t+1]<<8},Oe=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+2*(e[t+3]<<23)},Ce=function(e,t){return Oe(e,t)|4294967296*Oe(e,t)},Pe=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},Ne=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Pe(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var n=0;n<=r.length;++n)e[n+10]=r.charCodeAt(n)}},_e=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|2+(e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(2&t)},ke=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16)+2*(e[t-1]<<23)},De=function(e){return 10+(e.filename&&e.filename.length+1||0)},Fe=function(e,t){var r=t.level,n=0==r?0:r<6?1:9==r?3:2;e[0]=120,e[1]=n<<6|(n?32-2*n:1)},Ue=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function je(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var Be=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(fe(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),He=function(e,t){Ie([xe,function(){return[Re,Be]}],this,je.call(this,e,t),(function(e){var t=new Be(e.data);onmessage=Re(t)}),6)};function Ge(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Ae(e,t,[xe],(function(e){return Se(Ve(e.data[0],e.data[1]))}),0,r)}function Ve(e,t){return void 0===t&&(t={}),fe(e,t,0,0)}var ze=function(){function e(e){this.s={},this.p=new S(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,r=new S(t+e.length);r.set(this.p),r.set(e,t),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,r=Q(this.p,this.o,this.s);this.ondata(Z(r,t,this.s.b),this.d),this.o=Z(r,this.s.b-32768),this.s.b=this.o.length,this.p=Z(this.p,this.s.p/8>>0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Xe=function(e){this.ondata=e,Ie([ye,function(){return[Re,ze]}],this,0,(function(){var e=new ze;onmessage=Re(e)}),7)};function Ke(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Ae(e,t,[ye],(function(e){return Se(We(e.data[0],Ee(e.data[1])))}),1,r)}function We(e,t){return Q(e,t)}var qe=function(){function e(e,t){this.c=pe(),this.l=0,this.v=1,Be.call(this,e,t)}return e.prototype.push=function(e,t){Be.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var r=fe(e,this.o,this.v&&De(this.o),t&&8,!t);this.v&&(Ne(r,this.o),this.v=0),t&&(Pe(r,r.length-8,this.c.d()),Pe(r,r.length-4,this.l)),this.ondata(r,t)},e}(),Ye=function(e,t){Ie([xe,we,function(){return[Re,Be,qe]}],this,je.call(this,e,t),(function(e){var t=new qe(e.data);onmessage=Re(t)}),8)};function $e(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Ae(e,t,[xe,we,function(){return[Ze]}],(function(e){return Se(Ze(e.data[0],e.data[1]))}),2,r)}function Ze(e,t){void 0===t&&(t={});var r=pe(),n=e.length;r.p(e);var a=fe(e,t,De(t),8),i=a.length;return Ne(a,t),Pe(a,i-8,r.d()),Pe(a,i-4,n),a}var Qe=function(){function e(e){this.v=1,ze.call(this,e)}return e.prototype.push=function(e,t){if(ze.prototype.e.call(this,e),this.v){var r=_e(this.p);if(r>=this.p.length&&!t)return;this.p=this.p.subarray(r),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}ze.prototype.c.call(this,t)},e}(),Je=function(e){this.ondata=e,Ie([ye,be,function(){return[Re,ze,Qe]}],this,0,(function(){var e=new Qe;onmessage=Re(e)}),9)};function et(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Ae(e,t,[ye,be,function(){return[tt]}],(function(e){return Se(tt(e.data[0]))}),3,r)}function tt(e,t){return Q(e.subarray(_e(e),-8),t||new S(ke(e)))}var rt=function(){function e(e,t){this.c=he(),this.v=1,Be.call(this,e,t)}return e.prototype.push=function(e,t){Be.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var r=fe(e,this.o,this.v&&2,t&&4,!t);this.v&&(Fe(r,this.o),this.v=0),t&&Pe(r,r.length-4,this.c.d()),this.ondata(r,t)},e}(),nt=function(e,t){Ie([xe,Te,function(){return[Re,Be,rt]}],this,je.call(this,e,t),(function(e){var t=new rt(e.data);onmessage=Re(t)}),10)};function at(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Ae(e,t,[xe,Te,function(){return[it]}],(function(e){return Se(it(e.data[0],e.data[1]))}),4,r)}function it(e,t){void 0===t&&(t={});var r=he();r.p(e);var n=fe(e,t,2,4);return Fe(n,t),Pe(n,n.length-4,r.d()),n}var ot=function(){function e(e){this.v=1,ze.call(this,e)}return e.prototype.push=function(e,t){if(ze.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}ze.prototype.c.call(this,t)},e}(),st=function(e){this.ondata=e,Ie([ye,Me,function(){return[Re,ze,ot]}],this,0,(function(){var e=new ot;onmessage=Re(e)}),11)};function ut(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Ae(e,t,[ye,Me,function(){return[lt]}],(function(e){return Se(lt(e.data[0],Ee(e.data[1])))}),5,r)}function lt(e,t){return Q((Ue(e),e.subarray(2,-4)),t)}var ct=function(){function e(e){this.G=Qe,this.I=ze,this.Z=ot,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var r=new S(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var n=this,a=function(){n.ondata.apply(n,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(a):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(a):new this.Z(a),this.s.push(this.p,t),this.p=null}}},e}(),pt=function(){function e(e){this.G=Je,this.I=Xe,this.Z=st,this.ondata=e}return e.prototype.push=function(e,t){ct.prototype.push.call(this,e,t)},e}();function ht(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?et(e,t,r):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Ke(e,t,r):ut(e,t,r)}function ft(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?tt(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?We(e,t):lt(e,t)}var dt=function(e,t,r,n){for(var a in e){var i=e[a],o=t+a;i instanceof S?r[o]=[i,n]:Array.isArray(i)?r[o]=[i[0],de(n,i[1])]:dt(i,o+"/",r,n)}},vt="undefined"!=typeof TextEncoder&&new TextEncoder,mt="undefined"!=typeof TextDecoder&&new TextDecoder,gt=0;try{mt.decode(ue,{stream:!0}),gt=1}catch(gr){}var yt=function(e){for(var t="",r=0;;){var n=e[r++],a=(n>127)+(n>223)+(n>239);if(r+a>e.length)return[t,e.slice(r-1)];a?3==a?(n=((15&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|n>>10,56320|1023&n)):t+=1&a?String.fromCharCode((31&n)<<6|63&e[r++]):String.fromCharCode((15&n)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(n)}},xt=function(){function e(e){this.ondata=e,gt?this.t=new TextDecoder:this.p=ue}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t||(t=!1),this.t)return this.ondata(this.t.decode(e,{stream:!t}),t);var r=new S(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var n=yt(r),a=n[0],i=n[1];if(t&&i.length)throw"invalid utf-8 data";this.p=i,this.ondata(a,t)},e}(),wt=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";this.ondata(bt(e),t||!1)},e}();function bt(e,t){if(t){for(var r=new S(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}if(vt)return vt.encode(e);var a=e.length,i=new S(e.length+(e.length>>1)),o=0,s=function(e){i[o++]=e};for(n=0;n<a;++n){if(o+5>i.length){var u=new S(o+8+(a-n<<1));u.set(i),i=u}var l=e.charCodeAt(n);l<128||t?s(l):l<2048?(s(192|l>>>6),s(128|63&l)):l>55295&&l<57344?(s(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++n))>>>18),s(128|l>>>12&63),s(128|l>>>6&63),s(128|63&l)):(s(224|l>>>12),s(128|l>>>6&63),s(128|63&l))}return Z(i,0,o)}function Tt(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}if(mt)return mt.decode(e);var a=yt(e),i=a[0];if(a[1].length)throw"invalid utf-8 data";return i}var Mt=function(e){return 1==e?3:e<6?2:9==e?1:0},St=function(e,t){return t+30+Le(e,t+26)+Le(e,t+28)},Et=function(e,t,r){var n=Le(e,t+28),a=Tt(e.subarray(t+46,t+46+n),!(2048&Le(e,t+8))),i=t+46+n,o=Oe(e,t+20),s=r&&4294967295==o?At(e,i):[o,Oe(e,t+24),Oe(e,t+42)],u=s[0],l=s[1],c=s[2];return[Le(e,t+10),u,l,a,i+Le(e,t+30)+Le(e,t+32),c]},At=function(e,t){for(;1!=Le(e,t);t+=4+Le(e,t+2));return[Ce(e,t+12),Ce(e,t+4),Ce(e,t+20)]},Rt=function(e,t,r,n,a,i,o){var s=n.length;Pe(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==i&&8),e[t++]=a&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var u=new Date(null==r.mtime?Date.now():r.mtime),l=u.getFullYear()-1980;if(l<0||l>119)throw"date not in range 1980-2099";return Pe(e,t,2*(l<<24)|u.getMonth()+1<<21|u.getDate()<<16|u.getHours()<<11|u.getMinutes()<<5|u.getSeconds()>>>1),t+=4,null!=i&&(Pe(e,t,r.crc),Pe(e,t+4,i),Pe(e,t+8,r.size)),Pe(e,t+12,s),t+=16,null!=o&&(Pe(e,t+6,r.attrs),Pe(e,t+10,o),t+=14),e.set(n,t),t+s},It=function(e,t,r,n,a){Pe(e,t,101010256),Pe(e,t+8,r),Pe(e,t+10,r),Pe(e,t+12,n),Pe(e,t+16,a)},Lt=function(){function e(e){this.filename=e,this.c=pe(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),Ot=function(){function e(e,t){var r=this;void 0===t&&(t={}),Lt.call(this,e),this.d=new Be(t,(function(e,t){r.ondata(null,e,t)})),this.compression=8,this.flag=Mt(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){Lt.prototype.push.call(this,e,t)},e}(),Ct=function(){function e(e,t){var r=this;void 0===t&&(t={}),Lt.call(this,e),this.d=new He(t,(function(e,t,n){r.ondata(e,t,n)})),this.compression=8,this.flag=Mt(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){Lt.prototype.push.call(this,e,t)},e}(),Pt=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var r=bt(e.filename),n=r.length,a=n!=e.filename.length,i=n+30;if(n>65535)throw"filename too long";var o=new S(i);Rt(o,0,e,r,a);var s=[o],u=function(){for(var e=0,r=s;e<r.length;e++){var n=r[e];t.ondata(null,n,!1)}s=[]},l=this.d;this.d=0;var c=this.u.length,p=de(e,{f:r,u:a,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),l){var e=t.u[c+1];e?e.r():t.d=1}l=1}}),h=0;e.ondata=function(r,n,a){r?(t.ondata(r,n,a),t.terminate()):(h+=n.length,s.push(n),a?(s.push(function(e,t){var r=new S(16);return Pe(r,0,134695760),Pe(r,4,e.crc),Pe(r,8,t),Pe(r,12,e.size),r}(e,h)),p.c=h,p.b=i+h+16,p.crc=e.crc,p.size=e.size,l&&p.r(),l=1):l&&u())},this.u.push(p)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,r=0,n=0,a=this.u;n<a.length;n++)r+=46+(u=a[n]).f.length;for(var i=new S(r+22),o=0,s=this.u;o<s.length;o++){var u=s[o];Rt(i,e,u,u.f,u.u,u.c,t),e+=46+u.f.length,t+=u.b}It(i,e,this.u.length,r,t),this.ondata(null,i,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},e}();function Nt(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";var n={};dt(e,"",n,t);var a=Object.keys(n),i=a.length,o=0,s=0,u=i,l=new Array(i),c=[],p=function(){for(var e=0;e<c.length;++e)c[e]()},h=function(){var e=new S(s+22),t=o,n=s-o;s=0;for(var a=0;a<u;++a){var i=l[a];try{var c=i.c.length;Rt(e,s,i,i.f,i.u,c);var p=s+30+i.f.length;e.set(i.c,p),Rt(e,o,i,i.f,i.u,c,s),o+=46+i.f.length,s=p+c}catch(e){return r(e,null)}}It(e,o,l.length,n,t),r(null,e)};i||h();for(var f=function(e){var t=a[e],u=n[t],f=u[0],d=u[1],v=pe(),m=f.length;v.p(f);var g=bt(t),y=g.length,x=0==d.level?0:8,w=function(n,a){if(n)p(),r(n,null);else{var u=a.length;l[e]=de(d,{size:m,crc:v.d(),c:a,f:g,u:y!=t.length,compression:x}),o+=30+y+u,s+=76+2*y+u,--i||h()}};if(y>65535&&w("filename too long",null),x)if(m<16e4)try{w(null,Ve(f,d))}catch(e){w(e,null)}else c.push(Ge(f,d,w));else w(null,f)},d=0;d<u;++d)f(d);return p}function _t(e,t){void 0===t&&(t={});var r={},n=[];dt(e,"",r,t);var a=0,i=0;for(var o in r){var s=r[o],u=s[0],l=s[1],c=0==l.level?0:8,p=(x=bt(o)).length;if(p>65535)throw"filename too long";var h=c?Ve(u,l):u,f=h.length,d=pe();d.p(u),n.push(de(l,{size:u.length,crc:d.d(),c:h,f:x,u:p!=o.length,o:a,compression:c})),a+=30+p+f,i+=76+2*p+f}for(var v=new S(i+22),m=a,g=i-a,y=0;y<n.length;++y){var x=n[y];Rt(v,x.o,x,x.f,x.u,x.c.length),v.set(x.c,x.o+30+x.f.length),Rt(v,a,x,x.f,x.u,x.c.length,x.o),a+=46+x.f.length}return It(v,a,n.length,g,m),v}var kt=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),Dt=function(){function e(){var e=this;this.i=new ze((function(t,r){e.ondata(null,t,r)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(r){this.ondata(r,e,t)}},e.compression=8,e}(),Ft=function(){function e(){var e=this;this.i=new Xe((function(t,r,n){e.ondata(t,r,n)})),this.terminate=this.i.terminate}return e.prototype.push=function(e,t){this.i.push(Z(e,0),t)},e.compression=8,e}(),Ut=function(){function e(e){this.onfile=e,this.k=[],this.o={0:kt},this.p=ue}return e.prototype.push=function(e,t){var r=this,n=-1==this.c&&this.d;if(this.c&&!n){var a=Math.min(this.c,e.length),i=e.subarray(0,a);this.c-=a,this.d?this.d.push(i,!this.c):this.k[0].push([i,!this.c]),e=e.subarray(a)}if(n||!this.c){var o=0,s=0,u=void 0,l=void 0,c=e.length,p=this.p.length,h=c+p;if(c)p?((l=new Uint8Array(h)).set(this.p),l.set(e,this.p.length)):l=e;else{if(!p)return;l=this.p}this.p=ue;for(var f=function(){if(67324752==Oe(l,s)){o=1,n&&n.push(ue,!0),d.d=null,d.c=0;var e=Le(l,s+6),t=Le(l,s+8),a=2048&e,i=8&e,c=Le(l,s+26),p=Le(l,s+28);if(h>s+30+c+p){var f=[];d.k.unshift(f),o=2,u=s;var v=Oe(l,s+18),m=Tt(l.subarray(s+30,s+=30+c),!a);if(i&&(v=-1),4294967295==v&&(v=At(l,s)[0]),!d.o[t])return d.onfile("unknown compression type "+t,m,null),"break";d.c=v;var g={start:function(){if(!g.ondata)throw"no callback";if(v){var e=new r.o[t];e.ondata=function(e,t,r){g.ondata(e,t,r)};for(var n=0,a=f;n<a.length;n++){var i=a[n],o=i[0],s=i[1];e.push(o,s)}r.k[0]==f&&(r.d=e)}else g.ondata(null,new S(0),!0)},terminate:function(){r.k[0]==f&&r.d.terminate&&r.d.terminate()}};d.onfile(null,m,g),s+=p}return"break"}},d=this;s<h&&"break"!==f();++s);if(n&&n.push(2==o?l.subarray(0,u-12-(134695760==Oe(l,u-12)&&4)):l.subarray(0,s),!!o),2&o)return this.push(l.subarray(s),t);if(1&o&&(this.p=l),t&&(o||this.c))throw"invalid zip file"}},e.prototype.register=function(e){this.o[e.compression]=e},e}();function jt(e,t){if("function"!=typeof t)throw"no callback";for(var r=[],n=function(){for(var e=0;e<r.length;++e)r[e]()},a={},i=e.length-22;101010256!=Oe(e,i);--i)if(!i||e.length-i>65558)return void t("invalid zip file",null);var o=Le(e,i+8);o||t(null,{});var s=o,u=Oe(e,i+16),l=4294967295==u;if(l){if(i=Oe(e,i-12),101075792!=Oe(e,i))return void t("invalid zip file",null);s=o=Oe(e,i+32),u=Oe(e,i+48)}for(var c=function(i){var s=Et(e,u,l),c=s[0],p=s[1],h=s[2],f=s[3],d=s[4],v=s[5],m=St(e,v);u=d;var g=function(e,r){e?(n(),t(e,null)):(a[f]=r,--o||t(null,a))};if(c)if(8==c){var y=e.subarray(m,m+p);if(p<32e4)try{g(null,We(y,new S(h)))}catch(e){g(e,null)}else r.push(Ke(y,{size:h},g))}else g("unknown compression type "+c,null);else g(null,Z(e,m,m+p))},p=0;p<s;++p)c();return n}function Bt(e){for(var t={},r=e.length-22;101010256!=Oe(e,r);--r)if(!r||e.length-r>65558)throw"invalid zip file";var n=Le(e,r+8);if(!n)return{};var a=Oe(e,r+16),i=4294967295==a;if(i){if(r=Oe(e,r-12),101075792!=Oe(e,r))throw"invalid zip file";n=Oe(e,r+32),a=Oe(e,r+48)}for(var o=0;o<n;++o){var s=Et(e,a,i),u=s[0],l=s[1],c=s[2],p=s[3],h=s[4],f=s[5],d=St(e,f);if(a=h,u){if(8!=u)throw"unknown compression type "+u;t[p]=We(e.subarray(d,d+l),new S(c))}else t[p]=Z(e,d,d+l)}return t}var Ht={findSpan:function(e,t,r){var n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;for(var a=e,i=n,o=Math.floor((a+i)/2);t<r[o]||t>=r[o+1];)t<r[o]?i=o:a=o,o=Math.floor((a+i)/2);return o},calcBasisFunctions:function(e,t,r,n){var a=[],i=[],o=[];a[0]=1;for(var s=1;s<=r;++s){i[s]=t-n[e+1-s],o[s]=n[e+s]-t;for(var u=0,l=0;l<s;++l){var c=o[l+1],p=i[s-l],h=a[l]/(c+p);a[l]=u+c*h,u=p*h}a[s]=u}return a},calcBSplinePoint:function(e,t,r,n){for(var a=this.findSpan(e,n,t),o=this.calcBasisFunctions(a,n,e,t),s=new i.Vector4(0,0,0,0),u=0;u<=e;++u){var l=r[a-e+u],c=o[u],p=l.w*c;s.x+=l.x*p,s.y+=l.y*p,s.z+=l.z*p,s.w+=l.w*c}return s},calcBasisFunctionDerivatives:function(e,t,r,n,a){for(var i=[],o=0;o<=r;++o)i[o]=0;var s=[];for(o=0;o<=n;++o)s[o]=i.slice(0);var u=[];for(o=0;o<=r;++o)u[o]=i.slice(0);u[0][0]=1;for(var l=i.slice(0),c=i.slice(0),p=1;p<=r;++p){l[p]=t-a[e+1-p],c[p]=a[e+p]-t;for(var h=0,f=0;f<p;++f){var d=c[f+1],v=l[p-f];u[p][f]=d+v;var m=u[f][p-1]/u[p][f];u[f][p]=h+d*m,h=v*m}u[p][p]=h}for(p=0;p<=r;++p)s[0][p]=u[p][r];for(f=0;f<=r;++f){var g=0,y=1,x=[];for(o=0;o<=r;++o)x[o]=i.slice(0);x[0][0]=1;for(var w=1;w<=n;++w){var b=0,T=f-w,M=r-w;f>=w&&(x[y][0]=x[g][0]/u[M+1][T],b=x[y][0]*u[T][M]);var S=f-1<=M?w-1:r-f;for(p=T>=-1?1:-T;p<=S;++p)x[y][p]=(x[g][p]-x[g][p-1])/u[M+1][T+p],b+=x[y][p]*u[T+p][M];f<=M&&(x[y][w]=-x[g][w-1]/u[M+1][f],b+=x[y][w]*u[f][M]),s[w][f]=b;p=g;g=y,y=p}}for(f=r,w=1;w<=n;++w){for(p=0;p<=r;++p)s[w][p]*=f;f*=r-w}return s},calcBSplineDerivatives:function(e,t,r,n,a){for(var o=a<e?a:e,s=[],u=this.findSpan(e,n,t),l=this.calcBasisFunctionDerivatives(u,n,e,o,t),c=[],p=0;p<r.length;++p){var h=(d=r[p].clone()).w;d.x*=h,d.y*=h,d.z*=h,c[p]=d}for(var f=0;f<=o;++f){for(var d=c[u-e].clone().multiplyScalar(l[f][0]),v=1;v<=e;++v)d.add(c[u-e+v].clone().multiplyScalar(l[f][v]));s[f]=d}for(f=o+1;f<=a+1;++f)s[f]=new i.Vector4(0,0,0);return s},calcKoverI:function(e,t){for(var r=1,n=2;n<=e;++n)r*=n;var a=1;for(n=2;n<=t;++n)a*=n;for(n=2;n<=e-t;++n)a*=n;return r/a},calcRationalCurveDerivatives:function(e){for(var t=e.length,r=[],n=[],a=0;a<t;++a){var o=e[a];r[a]=new i.Vector3(o.x,o.y,o.z),n[a]=o.w}for(var s=[],u=0;u<t;++u){var l=r[u].clone();for(a=1;a<=u;++a)l.sub(s[u-a].clone().multiplyScalar(this.calcKoverI(u,a)*n[a]));s[u]=l.divideScalar(n[0])}return s},calcNURBSDerivatives:function(e,t,r,n,a){var i=this.calcBSplineDerivatives(e,t,r,n,a);return this.calcRationalCurveDerivatives(i)},calcSurfacePoint:function(e,t,r,n,a,o,s,u){for(var l=this.findSpan(e,o,r),c=this.findSpan(t,s,n),p=this.calcBasisFunctions(l,o,e,r),h=this.calcBasisFunctions(c,s,t,n),f=[],d=0;d<=t;++d){f[d]=new i.Vector4(0,0,0,0);for(var v=0;v<=e;++v){var m=a[l-e+v][c-t+d].clone(),g=m.w;m.x*=g,m.y*=g,m.z*=g,f[d].add(m.multiplyScalar(p[v]))}}var y=new i.Vector4(0,0,0,0);for(d=0;d<=t;++d)y.add(f[d].multiplyScalar(h[d]));y.divideScalar(y.w),u.set(y.x,y.y,y.z)}},Gt=function(e,t,r,n,a){i.Curve.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=a||this.knots.length-1;for(var o=0;o<r.length;++o){var s=r[o];this.controlPoints[o]=new i.Vector4(s.x,s.y,s.z,s.w)}};(Gt.prototype=Object.create(i.Curve.prototype)).constructor=Gt,Gt.prototype.getPoint=function(e,t){var r=t||new i.Vector3,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=Ht.calcBSplinePoint(this.degree,this.knots,this.controlPoints,n);return 1!=a.w&&a.divideScalar(a.w),r.set(a.x,a.y,a.z)},Gt.prototype.getTangent=function(e,t){var r=t||new i.Vector3,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=Ht.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,n,1);return r.copy(a[1]).normalize(),r};var Vt=function(){var e,t,r;function a(e){i.Loader.call(this,e)}function o(e,t){this.textureLoader=e,this.manager=t}function s(){}function u(){}function l(){}function c(){}function p(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function f(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function d(e){return e/46186158e3}a.prototype=Object.assign(Object.create(i.Loader.prototype),{constructor:a,load:function(e,t,r,n){var a=this,o=""===a.path?i.LoaderUtils.extractUrlBase(e):a.path,s=new i.FileLoader(this.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,(function(r){try{t(a.parse(r,o))}catch(i){n?n(i):console.error(i),a.manager.itemError(e)}}),r,n)},parse:function(t,r){if(function(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===T(e,0,t.length)}(t))e=(new c).parse(t);else{var n=T(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function n(t){var n=e[t-1];return e=e.slice(r+t),r++,n}for(var a=0;a<t.length;++a){if(n(1)===t[a])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(f(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+f(n));e=(new l).parse(n)}return new o(new i.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin),this.manager).parse(e)}}),o.prototype={constructor:o,parse:function(){t=this.parseConnections();var e=this.parseImages(),n=this.parseTextures(e),a=this.parseMaterials(n),i=this.parseDeformers(),o=(new s).parse(i);return this.parseScene(i,o,a),r},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach((function(e){var r=e[0],n=e[1],a=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var i={ID:n,relationship:a};t.get(r).parents.push(i),t.has(n)||t.set(n,{parents:[],children:[]});var o={ID:r,relationship:a};t.get(n).children.push(o)}));return t},parseImages:function(){var t={},r={};if("Video"in e.Objects){var n=e.Objects.Video;for(var a in n){var i=n[a];if(t[l=parseInt(a)]=i.RelativeFilename||i.Filename,"Content"in i){var o=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,s="string"===typeof i.Content&&""!==i.Content;if(o||s){var u=this.parseImage(n[a]);r[i.RelativeFilename||i.Filename]=u}}}}for(var l in t){var c=t[l];void 0!==r[c]?t[l]=r[c]:t[l]=t[l].split("\\").pop()}return t},parseImage:function(e){var t,r=e.Content,n=e.RelativeFilename||e.Filename,a=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if("string"===typeof r)return"data:"+t+";base64,"+r;var i=new Uint8Array(r);return window.URL.createObjectURL(new Blob([i],{type:t}))},parseTextures:function(t){var r=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var a in n){var i=this.parseTexture(n[a],t);r.set(parseInt(a),i)}}return r},parseTexture:function(e,t){var r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;var n=e.WrapModeU,a=e.WrapModeV,o=void 0!==n?n.value:0,s=void 0!==a?a.value:0;if(r.wrapS=0===o?i.RepeatWrapping:i.ClampToEdgeWrapping,r.wrapT=0===s?i.RepeatWrapping:i.ClampToEdgeWrapping,"Scaling"in e){var u=e.Scaling.value;r.repeat.x=u[0],r.repeat.y=u[1]}return r},loadTexture:function(e,r){var n,a,o=this.textureLoader.path,s=t.get(e.id).children;void 0!==s&&s.length>0&&void 0!==r[s[0].ID]&&(0!==(n=r[s[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var u=e.FileName.slice(-3).toLowerCase();if("tga"===u){var l=this.manager.getHandler(".tga");null===l?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new i.Texture):a=l.load(n)}else"psd"===u?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new i.Texture):a=this.textureLoader.load(n);return this.textureLoader.setPath(o),a},parseMaterials:function(t){var r=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var a in n){var i=this.parseMaterial(n[a],t);null!==i&&r.set(parseInt(a),i)}}return r},parseMaterial:function(e,r){var n=e.id,a=e.attrName,o=e.ShadingModel;if("object"===typeof o&&(o=o.value),!t.has(n))return null;var s,u=this.parseParameters(e,r,n);switch(o.toLowerCase()){case"phong":s=new i.MeshPhongMaterial;break;case"lambert":s=new i.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),s=new i.MeshPhongMaterial}return s.setValues(u),s.name=a,s},parseParameters:function(e,r,n){var a={};e.BumpFactor&&(a.bumpScale=e.BumpFactor.value),e.Diffuse?a.color=(new i.Color).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(a.color=(new i.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(a.displacementScale=e.DisplacementFactor.value),e.Emissive?a.emissive=(new i.Color).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(a.emissive=(new i.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(a.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(a.opacity=parseFloat(e.Opacity.value)),a.opacity<1&&(a.transparent=!0),e.ReflectionFactor&&(a.reflectivity=e.ReflectionFactor.value),e.Shininess&&(a.shininess=e.Shininess.value),e.Specular?a.specular=(new i.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(a.specular=(new i.Color).fromArray(e.SpecularColor.value));var o=this;return t.get(n).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":a.bumpMap=o.getTexture(r,e.ID);break;case"Maya|TEX_ao_map":a.aoMap=o.getTexture(r,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=o.getTexture(r,e.ID),a.map.encoding=i.sRGBEncoding;break;case"DisplacementColor":a.displacementMap=o.getTexture(r,e.ID);break;case"EmissiveColor":a.emissiveMap=o.getTexture(r,e.ID),a.emissiveMap.encoding=i.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=o.getTexture(r,e.ID);break;case"ReflectionColor":a.envMap=o.getTexture(r,e.ID),a.envMap.mapping=i.EquirectangularReflectionMapping,a.envMap.encoding=i.sRGBEncoding;break;case"SpecularColor":a.specularMap=o.getTexture(r,e.ID),a.specularMap.encoding=i.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=o.getTexture(r,e.ID),a.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),a},getTexture:function(r,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),r.get(n)},parseDeformers:function(){var r={},n={};if("Deformer"in e.Objects){var a=e.Objects.Deformer;for(var i in a){var o=a[i],s=t.get(parseInt(i));if("Skin"===o.attrType){var u=this.parseSkeleton(s,a);u.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),u.geometryID=s.parents[0].ID,r[i]=u}else if("BlendShape"===o.attrType){var l={id:i};l.rawTargets=this.parseMorphTargets(s,a),l.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[i]=l}}}return{skeletons:r,morphTargets:n}},parseSkeleton:function(e,t){var r=[];return e.children.forEach((function(e){var n=t[e.ID];if("Cluster"===n.attrType){var a={ID:e.ID,indices:[],weights:[],transformLink:(new i.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(a.indices=n.Indexes.a,a.weights=n.Weights.a),r.push(a)}})),{rawBones:r,bones:[]}},parseMorphTargets:function(e,r){for(var n=[],a=0;a<e.children.length;a++){var i=e.children[a],o=r[i.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=t.get(parseInt(i.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(s)}return n},parseScene:function(n,a,o){r=new i.Group;var s=this.parseModels(n.skeletons,a,o),l=e.Objects.Model,c=this;s.forEach((function(e){var n=l[e.ID];c.setLookAtProperties(e,n),t.get(e.ID).parents.forEach((function(t){var r=s.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&r.add(e)})),this.bindSkeleton(n.skeletons,a,s),this.createAmbientLight(),this.setupMorphMaterials(),r.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);var t=x(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));var p=(new u).parse();1===r.children.length&&r.children[0].isGroup&&(r.children[0].animations=p,r=r.children[0]),r.animations=p},parseModels:function(r,n,a){var o=new Map,s=e.Objects.Model;for(var u in s){var l=parseInt(u),c=s[u],p=t.get(l),h=this.buildSkeleton(p,r,l,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(p);break;case"Light":h=this.createLight(p);break;case"Mesh":h=this.createMesh(p,n,a);break;case"NurbsCurve":h=this.createCurve(p,n);break;case"LimbNode":case"Root":h=new i.Bone;break;case"Null":default:h=new i.Group}h.name=c.attrName?i.PropertyBinding.sanitizeNodeName(c.attrName):"",h.ID=l}this.getTransformData(h,c),o.set(l,h)}return o},buildSkeleton:function(e,t,r,n){var a=null;return e.parents.forEach((function(e){for(var o in t){var s=t[o];s.rawBones.forEach((function(t,o){if(t.ID===e.ID){var u=a;(a=new i.Bone).matrixWorld.copy(t.transformLink),a.name=n?i.PropertyBinding.sanitizeNodeName(n):"",a.ID=r,s.bones[o]=a,null!==u&&a.add(u)}}))}})),a},createCamera:function(t){var r,n;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)})),void 0===n)r=new i.Object3D;else{var a=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(a=1);var o=1;void 0!==n.NearPlane&&(o=n.NearPlane.value/1e3);var s=1e3;void 0!==n.FarPlane&&(s=n.FarPlane.value/1e3);var u=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(u=n.AspectWidth.value,l=n.AspectHeight.value);var c=u/l,p=45;void 0!==n.FieldOfView&&(p=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(a){case 0:r=new i.PerspectiveCamera(p,c,o,s),null!==h&&r.setFocalLength(h);break;case 1:r=new i.OrthographicCamera(-u/2,u/2,l/2,-l/2,o,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),r=new i.Object3D}}return r},createLight:function(t){var r,n;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)})),void 0===n)r=new i.Object3D;else{var a;a=void 0===n.LightType?0:n.LightType.value;var o=16777215;void 0!==n.Color&&(o=(new i.Color).fromArray(n.Color.value));var s=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(s=0);var u=0;void 0!==n.FarAttenuationEnd&&(u=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(a){case 0:r=new i.PointLight(o,s,u,1);break;case 1:r=new i.DirectionalLight(o,s);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=i.MathUtils.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=i.MathUtils.degToRad(n.OuterAngle.value),c=Math.max(c,1)),r=new i.SpotLight(o,s,u,l,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),r=new i.PointLight(o,s)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r},createMesh:function(e,t,r){var n,a=null,o=null,s=[];return e.children.forEach((function(e){t.has(e.ID)&&(a=t.get(e.ID)),r.has(e.ID)&&s.push(r.get(e.ID))})),s.length>1?o=s:s.length>0?o=s[0]:(o=new i.MeshPhongMaterial({color:13421772}),s.push(o)),"color"in a.attributes&&s.forEach((function(e){e.vertexColors=!0})),a.FBX_Deformer?(s.forEach((function(e){e.skinning=!0})),(n=new i.SkinnedMesh(a,o)).normalizeSkinWeights()):n=new i.Mesh(a,o),n},createCurve:function(e,t){var r=e.children.reduce((function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e}),null),n=new i.LineBasicMaterial({color:3342591,linewidth:1});return new i.Line(r,n)},getTransformData:function(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?w(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r},setLookAtProperties:function(n,a){"LookAtProperty"in a&&t.get(n.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var a=e.Objects.Model[t.ID];if("Lcl_Translation"in a){var o=a.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(o),r.add(n.target)):n.lookAt((new i.Vector3).fromArray(o))}}}))},bindSkeleton:function(e,r,n){var a=this.parsePoseNodes();for(var o in e){var s=e[o];t.get(parseInt(s.ID)).parents.forEach((function(e){if(r.has(e.ID)){var o=e.ID;t.get(o).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new i.Skeleton(s.bones),a[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var a=r[n].PoseNode;Array.isArray(a)?a.forEach((function(e){t[e.Node]=(new i.Matrix4).fromArray(e.Matrix.a)})):t[a.Node]=(new i.Matrix4).fromArray(a.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,n=t[0],a=t[1],o=t[2];if(0!==n||0!==a||0!==o){var s=new i.Color(n,a,o);r.add(new i.AmbientLight(s,1))}}},setupMorphMaterials:function(){var e=this;r.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(r,n){e.setupMorphMaterial(t,r,n)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,n){var a=e.uuid,i=t.uuid,o=!1;if(r.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===i&&e.uuid!==a&&(o=!0)})):e.material.uuid===i&&e.uuid!==a&&(o=!0))})),!0===o){var s=t.clone();s.morphTargets=!0,void 0===n?e.material=s:e.material[n]=s}else t.morphTargets=!0}},s.prototype={constructor:s,parse:function(r){var n=new Map;if("Geometry"in e.Objects){var a=e.Objects.Geometry;for(var i in a){var o=t.get(parseInt(i)),s=this.parseGeometry(o,a[i],r);n.set(parseInt(i),s)}}return n},parseGeometry:function(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,r,n){var a=n.skeletons,i=[],o=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==o.length){var s=t.children.reduce((function(e,t){return void 0!==a[t.ID]&&(e=a[t.ID]),e}),null);t.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&i.push(n.morphTargets[e.ID])}));var u=o[0],l={};"RotationOrder"in u&&(l.eulerOrder=w(u.RotationOrder.value)),"InheritType"in u&&(l.inheritType=parseInt(u.InheritType.value)),"GeometricTranslation"in u&&(l.translation=u.GeometricTranslation.value),"GeometricRotation"in u&&(l.rotation=u.GeometricRotation.value),"GeometricScaling"in u&&(l.scale=u.GeometricScaling.value);var c=x(l);return this.genGeometry(r,s,i,c)}},genGeometry:function(e,t,r,n){var a=new i.BufferGeometry;e.attrName&&(a.name=e.attrName);var o=this.parseGeoNode(e,t),s=this.genBuffers(o),u=new i.Float32BufferAttribute(s.vertex,3);if(u.applyMatrix4(n),a.setAttribute("position",u),s.colors.length>0&&a.setAttribute("color",new i.Float32BufferAttribute(s.colors,3)),t&&(a.setAttribute("skinIndex",new i.Uint16BufferAttribute(s.weightsIndices,4)),a.setAttribute("skinWeight",new i.Float32BufferAttribute(s.vertexWeights,4)),a.FBX_Deformer=t),s.normal.length>0){var l=(new i.Matrix3).getNormalMatrix(n),c=new i.Float32BufferAttribute(s.normal,3);c.applyNormalMatrix(l),a.setAttribute("normal",c)}if(s.uvs.forEach((function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),a.setAttribute(r,new i.Float32BufferAttribute(s.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){var p=s.materialIndex[0],h=0;if(s.materialIndex.forEach((function(e,t){e!==p&&(a.addGroup(h,t-h,p),p=e,h=t)})),a.groups.length>0){var f=a.groups[a.groups.length-1],d=f.start+f.count;d!==s.materialIndex.length&&a.addGroup(d,s.materialIndex.length-d,p)}0===a.groups.length&&a.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(a,e,r,n),a},parseGeoNode:function(e,t){var r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];for(var n=0;e.LayerElementUV[n];)e.LayerElementUV[n].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,a){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[a]})}))}))),r},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,a=!1,i=[],o=[],s=[],u=[],l=[],c=[],p=this;return e.vertexIndices.forEach((function(h,f){var d=!1;h<0&&(h^=-1,d=!0);var v=[],g=[];if(i.push(3*h,3*h+1,3*h+2),e.color){var y=m(f,r,h,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach((function(e){g.push(e.weight),v.push(e.id)})),g.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);var x=[0,0,0,0],w=[0,0,0,0];g.forEach((function(e,t){var r=e,n=v[t];w.forEach((function(e,t,a){if(r>e){a[t]=r,r=e;var i=x[t];x[t]=n,n=i}}))})),v=x,g=w}for(;g.length<4;)g.push(0),v.push(0);for(var b=0;b<4;++b)l.push(g[b]),c.push(v[b])}if(e.normal){y=m(f,r,h,e.normal);o.push(y[0],y[1],y[2])}if(e.material&&"AllSame"!==e.material.mappingType)var T=m(f,r,h,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var n=m(f,r,h,e);void 0===u[t]&&(u[t]=[]),u[t].push(n[0]),u[t].push(n[1])})),n++,d&&(p.genFace(t,e,i,T,o,s,u,l,c,n),r++,n=0,i=[],o=[],s=[],u=[],l=[],c=[])})),t},genFace:function(e,t,r,n,a,i,o,s,u,l){for(var c=2;c<l;c++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(c-1)]]),e.vertex.push(t.vertexPositions[r[3*(c-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(c-1)+2]]),e.vertex.push(t.vertexPositions[r[3*c]]),e.vertex.push(t.vertexPositions[r[3*c+1]]),e.vertex.push(t.vertexPositions[r[3*c+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(c-1)]),e.vertexWeights.push(s[4*(c-1)+1]),e.vertexWeights.push(s[4*(c-1)+2]),e.vertexWeights.push(s[4*(c-1)+3]),e.vertexWeights.push(s[4*c]),e.vertexWeights.push(s[4*c+1]),e.vertexWeights.push(s[4*c+2]),e.vertexWeights.push(s[4*c+3]),e.weightsIndices.push(u[0]),e.weightsIndices.push(u[1]),e.weightsIndices.push(u[2]),e.weightsIndices.push(u[3]),e.weightsIndices.push(u[4*(c-1)]),e.weightsIndices.push(u[4*(c-1)+1]),e.weightsIndices.push(u[4*(c-1)+2]),e.weightsIndices.push(u[4*(c-1)+3]),e.weightsIndices.push(u[4*c]),e.weightsIndices.push(u[4*c+1]),e.weightsIndices.push(u[4*c+2]),e.weightsIndices.push(u[4*c+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[3*(c-1)]),e.colors.push(i[3*(c-1)+1]),e.colors.push(i[3*(c-1)+2]),e.colors.push(i[3*c]),e.colors.push(i[3*c+1]),e.colors.push(i[3*c+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(a[0]),e.normal.push(a[1]),e.normal.push(a[2]),e.normal.push(a[3*(c-1)]),e.normal.push(a[3*(c-1)+1]),e.normal.push(a[3*(c-1)+2]),e.normal.push(a[3*c]),e.normal.push(a[3*c+1]),e.normal.push(a[3*c+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][2*(c-1)]),e.uvs[r].push(o[r][2*(c-1)+1]),e.uvs[r].push(o[r][2*c]),e.uvs[r].push(o[r][2*c+1])}))},addMorphTargets:function(t,r,n,a){if(0!==n.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var i=this;n.forEach((function(n){n.rawTargets.forEach((function(n){var o=e.Objects.Geometry[n.geoID];void 0!==o&&i.genMorphGeometry(t,r,o,a,n.name)}))}))}},genMorphGeometry:function(e,t,r,n,a){for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==r.Vertices?r.Vertices.a:[],u=void 0!==r.Indexes?r.Indexes.a:[],l=3*e.attributes.position.count,c=new Float32Array(l),p=0;p<u.length;p++){var h=3*u[p];c[h]=s[3*p],c[h+1]=s[3*p+1],c[h+2]=s[3*p+2]}var f={vertexIndices:o,vertexPositions:c},d=this.genBuffers(f),v=new i.Float32BufferAttribute(d.vertex,3);v.name=a||r.attrName,v.applyMatrix4(n),e.morphAttributes.position.push(v)},parseNormals:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,a=[];return"IndexToDirect"===r&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:a,mappingType:t,referenceType:r}},parseUVs:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,a=[];return"IndexToDirect"===r&&(a=e.UVIndex.a),{dataSize:2,buffer:n,indices:a,mappingType:t,referenceType:r}},parseVertexColors:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,a=[];return"IndexToDirect"===r&&(a=e.ColorIndex.a),{dataSize:4,buffer:n,indices:a,mappingType:t,referenceType:r}},parseMaterialIndices:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.Materials.a,a=[],i=0;i<n.length;++i)a.push(i);return{dataSize:1,buffer:n,indices:a,mappingType:t,referenceType:r}},parseNurbsGeometry:function(e){if(void 0===Gt)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new i.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new i.BufferGeometry;for(var r,n,a=t-1,o=e.KnotVector.a,s=[],u=e.Points.a,l=0,c=u.length;l<c;l+=4)s.push((new i.Vector4).fromArray(u,l));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){r=a,n=o.length-1-r;for(l=0;l<a;++l)s.push(s[l])}var p=new Gt(a,o,s,r,n).getPoints(7*s.length),h=new Float32Array(3*p.length);p.forEach((function(e,t){e.toArray(h,3*t)}));var f=new i.BufferGeometry;return f.setAttribute("position",new i.BufferAttribute(h,3)),f}},u.prototype={constructor:u,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var r in t){var n=t[r],a=this.addClip(n);e.push(a)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var r=this.parseAnimationLayers(t);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,r=new Map;for(var n in t){var a=t[n];if(null!==a.attrName.match(/S|R|T|DeformPercent/)){var i={id:a.id,attr:a.attrName,curves:{}};r.set(i.id,i)}}return r},parseAnimationCurves:function(r){var n=e.Objects.AnimationCurve;for(var a in n){var i={id:n[a].id,times:n[a].KeyTime.a.map(d),values:n[a].KeyValueFloat.a},o=t.get(i.id);if(void 0!==o){var s=o.parents[0].ID,u=o.parents[0].relationship;u.match(/X/)?r.get(s).curves.x=i:u.match(/Y/)?r.get(s).curves.y=i:u.match(/Z/)?r.get(s).curves.z=i:u.match(/d|DeformPercent/)&&r.has(s)&&(r.get(s).curves.morph=i)}}},parseAnimationLayers:function(n){var a=e.Objects.AnimationLayer,o=new Map;for(var s in a){var u=[],l=t.get(parseInt(s));if(void 0!==l)l.children.forEach((function(a,o){if(n.has(a.ID)){var s=n.get(a.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===u[o])if(void 0!==(d=t.get(a.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID)){if(void 0===(c=e.Objects.Model[d.toString()]))return void console.warn("THREE.FBXLoader: Encountered a unused curve.",a);var l={modelName:c.attrName?i.PropertyBinding.sanitizeNodeName(c.attrName):"",ID:c.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};r.traverse((function(e){e.ID===c.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))})),l.transform||(l.transform=new i.Matrix4),"PreRotation"in c&&(l.preRotation=c.PreRotation.value),"PostRotation"in c&&(l.postRotation=c.PostRotation.value),u[o]=l}u[o]&&(u[o][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===u[o]){var c,p=t.get(a.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,h=t.get(p).parents[0].ID,f=t.get(h).parents[0].ID,d=t.get(f).parents[0].ID;l={modelName:(c=e.Objects.Model[d]).attrName?i.PropertyBinding.sanitizeNodeName(c.attrName):"",morphName:e.Objects.Deformer[p].attrName};u[o]=l}u[o][s.attr]=s}}})),o.set(parseInt(s),u)}return o},parseAnimStacks:function(r){var n=e.Objects.AnimationStack,a={};for(var i in n){var o=t.get(parseInt(i)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(o[0].ID);a[i]={name:n[i].attrName,layer:s}}return a},addClip:function(e){var t=[],r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new i.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],r=new i.Vector3,n=new i.Quaternion,a=new i.Vector3;if(e.transform&&e.transform.decompose(r,n,a),r=r.toArray(),n=(new i.Euler).setFromQuaternion(n,e.eulerOrder).toArray(),a=a.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var s=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==s&&t.push(s)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var u=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");void 0!==u&&t.push(u)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,r,n){var a=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(a,t,r);return new i.VectorKeyframeTrack(e+"."+n,a,o)},generateRotationTrack:function(e,t,r,n,a,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(i.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(i.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(i.MathUtils.degToRad));var s=this.getTimesForAllAxes(t),u=this.getKeyframeTrackValues(s,t,r);void 0!==n&&((n=n.map(i.MathUtils.degToRad)).push(o),n=(new i.Euler).fromArray(n),n=(new i.Quaternion).setFromEuler(n)),void 0!==a&&((a=a.map(i.MathUtils.degToRad)).push(o),a=(new i.Euler).fromArray(a),a=(new i.Quaternion).setFromEuler(a).invert());for(var l=new i.Quaternion,c=new i.Euler,p=[],h=0;h<u.length;h+=3)c.set(u[h],u[h+1],u[h+2],o),l.setFromEuler(c),void 0!==n&&l.premultiply(n),void 0!==a&&l.multiply(a),l.toArray(p,h/3*4);return new i.QuaternionKeyframeTrack(e+".quaternion",s,p)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),a=r.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new i.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+a+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort((function(e,t){return e-t}))).length>1){for(var r=1,n=t[0],a=1;a<t.length;a++){var i=t[a];i!==n&&(t[r]=i,n=i,r++)}t=t.slice(0,r)}return t},getKeyframeTrackValues:function(e,t,r){var n=r,a=[],i=-1,o=-1,s=-1;return e.forEach((function(e){if(t.x&&(i=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==i){var r=t.x.values[i];a.push(r),n[0]=r}else a.push(n[0]);if(-1!==o){var u=t.y.values[o];a.push(u),n[1]=u}else a.push(n[1]);if(-1!==s){var l=t.z.values[s];a.push(l),n[2]=l}else a.push(n[2])})),a},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var r=e.values[t-1],n=e.values[t]-r,a=Math.abs(n);if(a>=180){for(var i=a/180,o=n/i,s=r+o,u=e.times[t-1],l=(e.times[t]-u)/i,c=u+l,p=[],h=[];c<e.times[t];)p.push(c),c+=l,h.push(s),s+=o;e.times=M(e.times,t,p),e.values=M(e.values,t,h)}}}},l.prototype={constructor:l,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,n){var a=e.match(/^[\s\t]*;/),i=e.match(/^[\s\t]*$/);if(!a&&!i){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++n]):u?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),a={name:r},i=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,a):r in o?("PoseNode"===r?o.PoseNode.push(a):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==i.id&&(o[r][i.id]=a)):"number"===typeof i.id?(o[r]={},o[r][i.id]=a):"Properties70"!==r&&(o[r]="PoseNode"===r?[a]:a),"number"===typeof i.id&&(a.id=i.id),""!==i.name&&(a.attrName=i.name),""!==i.type&&(a.attrType=i.type),this.pushStack(a)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(e,t,r){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===a&&(a=r.replace(/"/g,"").replace(/,$/,"").trim());var i=this.getCurrentNode();if("Properties70"!==i.name){if("C"===n){var o=a.split(",").slice(1),s=parseInt(o[0]),u=parseInt(o[1]),l=a.split(",").slice(3);n="connections",function(e,t){for(var r=0,n=e.length,a=t.length;r<a;r++,n++)e[n]=t[r]}(a=[s,u],l=l.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===i[n]&&(i[n]=[])}"Node"===n&&(i.id=a),n in i&&Array.isArray(i[n])?i[n].push(a):"a"!==n?i[n]=a:i.a=a,this.setCurrentProp(i,n),"a"===n&&","!==a.slice(-1)&&(i.a=b(a))}else this.parseNodeSpecialProperty(e,n,a)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))},parseNodeSpecialProperty:function(e,t,r){var n=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),a=n[0],i=n[1],o=n[2],s=n[3],u=n[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=b(u)}this.getPrevNode()[a]={type:i,type2:o,flag:s,value:u},this.setCurrentProp(this.getPrevNode(),a)}},c.prototype={constructor:c,parse:function(e){var t=new p(e);t.skip(23);var r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);for(var n=new h;!this.endOfContent(t);){var a=this.parseNode(t,r);null!==a&&n.add(a.name,a)}return n},endOfContent:function(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},n=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var i=e.getUint8(),o=e.getString(i);if(0===n)return null;for(var s=[],u=0;u<a;u++)s.push(this.parseProperty(e));var l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",p=s.length>2?s[2]:"";for(r.singleProperty=1===a&&e.getOffset()===n;n>e.getOffset();){var h=this.parseNode(e,t);null!==h&&this.parseSubNode(o,r,h)}return r.propertyList=s,"number"===typeof l&&(r.id=l),""!==c&&(r.attrName=c),""!==p&&(r.attrType=p),""!==o&&(r.name=o),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(t[r.name]=r,r.a=n):t[r.name]=n}else if("Connections"===e&&"C"===r.name){var a=[];r.propertyList.forEach((function(e,t){0!==t&&a.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(a)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){var i,o=r.propertyList[0],s=r.propertyList[1],u=r.propertyList[2],l=r.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),i="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[o]={type:s,type2:u,flag:l,value:i}}else void 0===t[r.name]?"number"===typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var a=e.getUint32(),i=e.getUint32(),o=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}"undefined"===typeof n&&console.error("THREE.FBXLoader: External library fflate.min.js required.");var s=new p(lt(new Uint8Array(e.getArrayBuffer(o))).buffer);switch(t){case"b":case"c":return s.getBooleanArray(a);case"d":return s.getFloat64Array(a);case"f":return s.getFloat32Array(a);case"i":return s.getInt32Array(a);case"l":return s.getInt64Array(a)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},p.prototype={constructor:p,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1===(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],r=0;r<e;r++)t[r]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),i.LoaderUtils.decodeText(new Uint8Array(t))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var v=[];function m(e,t,r,n){var a;switch(n.mappingType){case"ByPolygonVertex":a=e;break;case"ByPolygon":a=t;break;case"ByVertice":a=r;break;case"AllSame":a=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(a=n.indices[a]);var i=a*n.dataSize,o=i+n.dataSize;return function(e,t,r,n){for(var a=r,i=0;a<n;a++,i++)e[i]=t[a];return e}(v,n.buffer,i,o)}var g=new i.Euler,y=new i.Vector3;function x(e){var t,r=new i.Matrix4,n=new i.Matrix4,a=new i.Matrix4,o=new i.Matrix4,s=new i.Matrix4,u=new i.Matrix4,l=new i.Matrix4,c=new i.Matrix4,p=new i.Matrix4,h=new i.Matrix4,f=new i.Matrix4,d=new i.Matrix4,v=e.inheritType?e.inheritType:0;(e.translation&&r.setPosition(y.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(i.MathUtils.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(g.fromArray(t)));e.rotation&&((t=e.rotation.map(i.MathUtils.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(g.fromArray(t)));e.postRotation&&((t=e.postRotation.map(i.MathUtils.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(g.fromArray(t)),o.invert());e.scale&&s.scale(y.fromArray(e.scale)),e.scalingOffset&&l.setPosition(y.fromArray(e.scalingOffset)),e.scalingPivot&&u.setPosition(y.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(y.fromArray(e.rotationOffset)),e.rotationPivot&&p.setPosition(y.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(f.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));var m=(new i.Matrix4).copy(n).multiply(a).multiply(o),x=new i.Matrix4;x.extractRotation(h);var w=new i.Matrix4;w.copyPosition(h);var b=new i.Matrix4,T=(new i.Matrix4).copy(w).invert().multiply(h);b.copy(x).invert().multiply(T);var M=s,S=new i.Matrix4;if(0===v)S.copy(x).multiply(m).multiply(b).multiply(M);else if(1===v)S.copy(x).multiply(b).multiply(m).multiply(M);else{var E=(new i.Matrix4).scale((new i.Vector3).setFromMatrixScale(f)),A=(new i.Matrix4).copy(E).invert(),R=(new i.Matrix4).copy(b).multiply(A);S.copy(x).multiply(m).multiply(R).multiply(M)}var I=new i.Matrix4;I.copy(p).invert();var L=new i.Matrix4;L.copy(u).invert();var O=new i.Matrix4;O.copy(r).multiply(c).multiply(p).multiply(n).multiply(a).multiply(o).multiply(I).multiply(l).multiply(u).multiply(s).multiply(L);var C=(new i.Matrix4).copyPosition(O),P=(new i.Matrix4).copy(h).multiply(C);return d.copyPosition(P),(O=(new i.Matrix4).copy(d).multiply(S)).premultiply(h.invert()),O}function w(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function b(e){return e.split(",").map((function(e){return parseFloat(e)}))}function T(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),i.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function M(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}return a}();class zt{constructor(e,t,r,n,a){this.controller=t,this.handModel=e,this.bones=[];const i=new Vt,o=a&&"lowpoly"===a.model?"_low":"";i.setPath(r),i.load(`OculusHand_${"right"===n?"R":"L"}${o}.fbx`,(e=>{this.handModel.add(e),e.scale.setScalar(.01);const t=e.getObjectByProperty("type","SkinnedMesh");t.frustumCulled=!1,t.castShadow=!0,t.receiveShadow=!0;const r=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"];let a=0;["b_%_wrist","b_%_thumb1","b_%_thumb2","b_%_thumb3","b_%_thumb_null",null,"b_%_index1","b_%_index2","b_%_index3","b_%_index_null",null,"b_%_middle1","b_%_middle2","b_%_middle3","b_%_middlenull",null,"b_%_ring1","b_%_ring2","b_%_ring3","b_%_ring_inull","b_%_pinky0","b_%_pinky1","b_%_pinky2","b_%_pinky3","b_%_pinkynull"].forEach((t=>{if(t){const i=e.getObjectByName(t.replace(/%/g,"right"===n?"r":"l"));void 0!==i&&(i.jointName=r[a]),this.bones.push(i)}else this.bones.push(null);a++}))}))}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const r=this.bones[t];if(r){const t=e[r.jointName];if(t.visible){const e=t.position;r&&(r.position.copy(e.clone().multiplyScalar(100)),r.quaternion.copy(t.quaternion))}}}}}function Xt(e){i.Object3D.call(this),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null}Xt.prototype=Object.assign(Object.create(i.Object3D.prototype),{constructor:Xt,updateMatrixWorld:function(e){i.Object3D.prototype.updateMatrixWorld.call(this,e),this.motionController&&this.motionController.updateMesh()}});const Kt=function(){function e(){this.path=""}return e.prototype={constructor:e,setPath:function(e){return this.path=e,this},createHandModel:function(e,t,r){const n=new Xt(e);return e.addEventListener("connected",(a=>{const i=a.data;i.hand&&!n.motionController&&(n.visible=!0,n.xrInputSource=i,void 0===t||"spheres"===t?n.motionController=new T(n,e,this.path,i.handedness,{primitive:"sphere"}):"boxes"===t?n.motionController=new T(n,e,this.path,i.handedness,{primitive:"box"}):"oculus"===t&&(n.motionController=new zt(n,e,this.path,i.handedness,r)))})),e.addEventListener("disconnected",(()=>{})),n}},e}(),Wt={make:(e,t,r,n)=>{const a=t.xr.getController(e),i=t.xr.getControllerGrip(e),o={inputSource:void 0,grip:i,controller:a};i.userData.name="grip",a.userData.name="controller",a.addEventListener("connected",(e=>{e.fake||(o.inputSource=e.data,r(o))})),a.addEventListener("disconnected",(e=>{n(o)}))}},qt=function(){return new Map},Yt=function(e,t,r,n){e.has(t)||e.set(t,{key:[n]});const a=e.get(t);a[r]||(a[r]=[]),a[r].push(n)},$t=function(e,t,r,n){const a=e.get(t);a&&a[r]&&(a[r]=a[r].filter((e=>e!==n)),0===a[r].length&&delete a[r],0===Object.keys(a).length&&e.delete(t))},Zt=function(e,t,r){const n=e.get(t);return!(!n||!n[r])},Qt=function(e,t,r){const n=e.get(t);return n&&n[r]},Jt=(e,t,{handedness:r}={})=>{const n=x.a.useRef(t);x.a.useEffect((()=>{n.current=t}),[t]);const{controllers:a}=pr();x.a.useEffect((()=>{const t=r?a.filter((e=>e.inputSource.handedness===r)):a,i=[];return t.forEach((t=>{const r=e=>n.current({originalEvent:e,controller:t});t.controller.addEventListener(e,r),i.push((()=>t.controller.removeEventListener(e,r)))})),()=>i.forEach((e=>e()))}),[e,a,r])},er=x.a.createContext({});function tr({children:e}){const{controllers:t}=pr(),[r]=x.a.useState((()=>({left:new Map,right:new Map,none:new Map}))),[n]=x.a.useState((()=>qt())),a=x.a.useCallback(((e,t,r)=>{Yt(n,e,t,r)}),[n]),o=x.a.useCallback(((e,t,r)=>{$t(n,e,t,r)}),[n]),[s]=x.a.useState((()=>new i.Raycaster)),u=x.a.useCallback((e=>{const t=Array.from(n.keys()),r=new i.Matrix4;return r.identity().extractRotation(e.matrixWorld),s.ray.origin.setFromMatrixPosition(e.matrixWorld),s.ray.direction.set(0,0,-1).applyMatrix4(r),s.intersectObjects(t,!0)}),[n,s]);Object(w.b)((()=>{0!==n.size&&t.forEach((e=>{const{controller:t}=e,a=e.inputSource.handedness,i=r[a],o=new Set;u(t).forEach((t=>{let r=t.object;for(;r;){var a;if(Zt(n,r,"onHover")&&!i.has(r))null==(a=Qt(n,r,"onHover"))||a.forEach((r=>r({controller:e,intersection:t})));i.set(r,t),o.add(r.id),r=r.parent}}));for(const r of i.keys()){var s;if(!o.has(r.id))null==(s=Qt(n,r,"onBlur"))||s.forEach((t=>t({controller:e}))),i.delete(r)}}))}));const l=e=>t=>{const a=r[t.controller.inputSource.handedness];for(const r of a.keys()){var i;null==(i=Qt(n,r,e))||i.forEach((e=>e({controller:t.controller})))}};Jt("select",l("onSelect")),Jt("selectstart",l("onSelectStart")),Jt("selectend",l("onSelectEnd")),Jt("squeeze",l("onSqueeze")),Jt("squeezeend",l("onSqueezeEnd")),Jt("squeezestart",l("onSqueezeStart"));const c=Object(y.useMemo)((()=>({addInteraction:a,removeInteraction:o,hoverState:r})),[a,o,r]);return x.a.createElement(er.Provider,{value:c},e)}const rr=(e,t,r)=>{const{addInteraction:n,removeInteraction:a}=Object(y.useContext)(er),i=void 0!==r,o=Object(y.useRef)(r);Object(y.useEffect)((()=>{o.current=r}),[r]),Object(y.useEffect)((()=>{if(!i)return;const r=e=>{o.current(e)};n(e.current,t,r);const s=e.current;return()=>a(s,t,r)}),[t,n,a,i,e])},nr=Object(y.forwardRef)(((e,t)=>{const r=Object(y.useRef)();return rr(r,"onHover",e.onHover),rr(r,"onBlur",e.onBlur),rr(r,"onSelectStart",e.onSelectStart),rr(r,"onSelectEnd",e.onSelectEnd),rr(r,"onSelect",e.onSelect),rr(r,"onSqueezeStart",e.onSqueezeStart),rr(r,"onSqueezeEnd",e.onSqueezeEnd),rr(r,"onSqueeze",e.onSqueeze),x.a.createElement("group",{ref:Object(b.a)([t,r])},e.children)}));function ar({children:e}){const t=Object(y.useRef)(),r=Object(y.useRef)(),n=Object(y.useRef)(void 0);return Jt("selectend",(e=>{e.controller.controller===t.current&&(t.current=void 0,n.current=void 0)})),Object(w.b)((()=>{if(!t.current||!n.current||!r.current)return;const e=t.current,a=r.current;a.applyMatrix4(n.current),a.applyMatrix4(e.matrixWorld),a.updateWorldMatrix(!1,!0),n.current.getInverse(e.matrixWorld)})),x.a.createElement(nr,{ref:r,onSelectStart:e=>{t.current=e.controller.controller,n.current=(new i.Matrix4).getInverse(e.controller.controller.matrixWorld)}},e)}const ir=Object(y.createContext)({});function or(e){const{gl:t}=Object(w.c)(),r=Object(y.useRef)(),n=Object(y.useRef)(!1),[a]=Object(y.useState)((()=>new i.Matrix4));Object(w.b)((()=>{if(!t.xr.isPresenting)return;const i=t.xr.getSession();if(n.current||(i.requestReferenceSpace("viewer").then((e=>{i.requestHitTestSource({space:e}).then((e=>{r.current=e}))})),i.addEventListener("end",(()=>{n.current=!1,r.current=void 0}),{once:!0}),n.current=!0),r.current&&t.xr.isPresenting){const n=t.xr.getReferenceSpace();i.requestAnimationFrame(((t,i)=>{const o=i.getHitTestResults(r.current);if(o.length){const t=o[0];a.fromArray(t.getPose(n).transform.matrix),e(a,t)}}))}}))}function sr(e){const{gl:t,camera:r}=Object(w.c)(),[n,a]=Object(y.useState)((()=>t.xr.isPresenting)),[o]=Object(y.useState)((()=>new i.Group)),s=(e=>{const{gl:t}=Object(w.c)(),[r,n]=Object(y.useState)([]);return Object(y.useEffect)((()=>{[0,1].forEach((r=>{Wt.make(r,t,(t=>{e.add(t.controller),e.add(t.grip),n((e=>[...e,t]))}),(t=>{e.remove(t.controller),e.remove(t.grip),n((e=>e.filter((e=>e!==t))))}))}))}),[t,e]),r})(o);Object(y.useEffect)((()=>{const e=t.xr,r=()=>a(e.isPresenting);return e.addEventListener("sessionstart",r),e.addEventListener("sessionend",r),()=>{e.removeEventListener("sessionstart",r),e.removeEventListener("sessionend",r)}}),[t]);const u=Object(y.useMemo)((()=>({controllers:s,isPresenting:n,player:o})),[s,n,o]);return Object(y.createElement)(ir.Provider,{value:u},Object(y.createElement)("primitive",{object:o,dispose:null},Object(y.createElement)("primitive",{object:r,dispose:null})),e.children)}function ur(e){let{children:t}=e,r=Object(g.a)(e,["children"]);return Object(y.createElement)(w.a,Object(a.a)({vr:!0},r),Object(y.createElement)(sr,null,Object(y.createElement)(tr,null,t)))}function lr(e){let{children:t}=e,r=Object(g.a)(e,["children"]);return Object(y.createElement)(ur,Object(a.a)({onCreated:({gl:e})=>{document.body.appendChild(class{static createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const r=document.createElement("button");function n(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,r.textContent="VR NOT SUPPORTED"}function a(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return r.id="VRButton",r.style.display="none",a(r),navigator.xr.isSessionSupported("immersive-vr").then((function(t){t?function(){let t=null;async function n(n){n.addEventListener("end",a),await e.xr.setSession(n),r.textContent="EXIT VR",t=n}function a(){t.removeEventListener("end",a),r.textContent="ENTER VR",t=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR",r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){if(null===t){const e={optionalFeatures:["local-floor","bounded-floor","hand-tracking"]};navigator.xr.requestSession("immersive-vr",e).then(n)}else t.end()}}():n()})),r;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",a(e),e}}}.createButton(e))}},r),t)}function cr(e){let{children:t,sessionInit:r}=e,n=Object(g.a)(e,["children","sessionInit"]);return Object(y.createElement)(ur,Object(a.a)({onCreated:({gl:e})=>{document.body.appendChild(class{static createButton(e,t={}){const r=document.createElement("button");function n(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,r.textContent="AR NOT SUPPORTED"}function a(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return r.id="ARButton",r.style.display="none",a(r),navigator.xr.isSessionSupported("immersive-ar").then((function(a){a?function(){if(void 0===t.domOverlay){var n=document.createElement("div");n.style.display="none",document.body.appendChild(n);var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("width",38),a.setAttribute("height",38),a.style.position="absolute",a.style.right="20px",a.style.top="20px",a.addEventListener("click",(function(){o.end()})),n.appendChild(a);var i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),i.setAttribute("stroke","#fff"),i.setAttribute("stroke-width",2),a.appendChild(i),t.optionalFeatures=["dom-overlay"],t.domOverlay={root:n}}let o=null;async function s(n){n.addEventListener("end",u),e.xr.setReferenceSpaceType("local"),await e.xr.setSession(n),r.textContent="STOP AR",t.domOverlay.root.style.display="",o=n}function u(){o.removeEventListener("end",u),r.textContent="START AR",t.domOverlay.root.style.display="none",o=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="START AR",r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){null===o?navigator.xr.requestSession("immersive-ar",t).then(s):o.end()}}():n()})).catch(n),r;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",a(e),e}}}.createButton(e,r))}},n),t)}const pr=()=>{const e=Object(y.useContext)(ir),t=Object(y.useContext)(er);return Object(y.useMemo)((()=>Object(a.a)(Object(a.a)({},e),t)),[e,t])},hr=e=>{const{controllers:t}=pr();return Object(y.useMemo)((()=>t.find((t=>t.inputSource.handedness===e))),[e,t])},fr=new m,dr=new WeakMap;function vr({rayMaterial:e={}}){const{scene:t}=Object(w.c)(),{controllers:r,hoverState:n}=pr(),[o]=x.a.useState(new Map);return Object(w.b)((()=>{r.forEach((e=>{const t=o.get(e.controller.id);if(!t)return;const r=n[e.inputSource.handedness].values().next().value;if(!r||"none"===e.inputSource.handedness)return void(t.visible=!1);const a=r.distance;t.visible=!0,t.scale.y=a+-.01,t.position.z=-a/2- -.01}))})),Object(y.useEffect)((()=>{const t=[];return r.forEach((({controller:r,grip:n,inputSource:s})=>{let u;dr.has(r)?u=dr.get(r):(u=fr.createControllerModel(r),r.dispatchEvent({type:"connected",data:s,fake:!0}),dr.set(r,u)),n.add(u);const l=new i.Mesh;l.rotation.set(Math.PI/2,0,0),l.material=new i.MeshBasicMaterial(Object(a.a)({color:new i.Color(16777215),opacity:.8,transparent:!0},e)),l.geometry=new i.BoxBufferGeometry(.002,1,.002),o.set(r.id,l),r.add(l),t.push((()=>{n.remove(u),r.remove(l),o.delete(r.id)}))})),()=>{t.forEach((e=>e()))}}),[r,t,o,JSON.stringify(e)]),null}function mr({profile:e="oculus"}){const{scene:t,gl:r}=Object(w.c)();return Object(y.useEffect)((()=>{const n=(new Kt).setPath("https://threejs.org/examples/models/fbx/"),a="oculus_lowpoly"===e?{model:"lowpoly"}:void 0,i="oculus_lowpoly"===e?"oculus":e,o=r.xr.getHand(0);t.add(o),o.add(n.createHandModel(o,i,a));const s=r.xr.getHand(1);t.add(s),s.add(n.createHandModel(s,i,a))}),[t,r]),null}},zLVn:function(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}r.d(t,"a",(function(){return n}))}}]);